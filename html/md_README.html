<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TEC: TEC: Header-Only, Template-Based C++ Library for Multithreaded Execution in Concurrent Environments</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">TEC
   </div>
   <div id="projectbrief">A lightweight C++ library enabling safe, efficient execution in multithreaded and concurrent systems.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_README.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">TEC: Header-Only, Template-Based C++ Library for Multithreaded Execution in Concurrent Environments</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Contents</h1>
<ul>
<li>Introduction<ul>
<li>Why C++17</li>
</ul>
</li>
<li>Core Abstractions<ul>
<li>Daemon</li>
<li>Worker<ul>
<li>Example 1.1 Common Header</li>
<li>Example 1.2 TestWorker</li>
<li>Example 1.3 Run TestWorker as Daemon</li>
</ul>
</li>
<li>Actor<ul>
<li>Example 2.1 Actor Implementation</li>
</ul>
</li>
<li>ActorWorker</li>
</ul>
</li>
<li>General Purpose Building Blocks<ul>
<li>NetData<ul>
<li>Example 3.1 Test Data Definitions</li>
<li>Example 3.2 The Use of NetData<ul>
<li>Example 3.2a</li>
</ul>
</li>
</ul>
</li>
<li>BSD Socket Wrappers</li>
</ul>
</li>
<li>Networking Layer<ul>
<li>SocketServer<ul>
<li>Example 4.1 TCP echo server</li>
</ul>
</li>
<li>SocketClient<ul>
<li>Example 5.1 Socket Client</li>
</ul>
</li>
<li>SocketServerNd<ul>
<li>Example 6.1 NetData Server</li>
</ul>
</li>
<li>SocketClientNd<ul>
<li>Example 7.1 NetData Client</li>
</ul>
</li>
</ul>
</li>
<li>Test Results</li>
<li>Additional Utilities</li>
<li><a class="el" href="dir_68db02de3583aeddd1f808b74ff83520.html">gRPC</a><ul>
<li>Motivation</li>
<li>GrpcServerParams</li>
<li>GrpcClientParams</li>
<li>GrpcServer<ul>
<li>Example 8.1 GrpcServer Declarations</li>
<li>Example 8.2 GrpcServer Implementation</li>
<li>Example 8.3 Run GrpcServer</li>
</ul>
</li>
<li>GrpcClient<ul>
<li>Example 9.1 GrpcClient Declarations</li>
<li>Example 9.2 GrpcClient Implementation</li>
<li>Example 9.3 Run GrpcClient</li>
</ul>
</li>
</ul>
</li>
<li>LICENSE</li>
<li>NOTICE</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Introduction</h1>
<p>The TEC library is a lightweight and fast C++ framework designed for efficient performance in resource-constrained environments. It is entirely <b>header-only</b> and <b>template-based</b>, allowing seamless integration without additional compilation steps or external dependencies. The library enables safe, efficient execution in multithreaded and concurrent systems.</p>
<p>The library is highly extendable, with most members being virtual to facilitate customization through inheritance and overriding. It includes robust multithreading support to handle concurrent operations safely and efficiently.</p>
<p>Additionally, TEC provides a lightweight <em>binary serialization</em> mechanism for compact data packing and unpacking, ideal for network transmission or storage.</p>
<p>It also features a platform-independent, <em>BSD socket-based</em> networking toolkit that enables cross-platform socket communication without platform-specific code.</p>
<p>Note that TEC has <b>no external dependencies</b> (the use of <em>gRPC</em> and <em>Zlib</em> is optional), ensuring it can be dropped into any project without requiring third-party libraries or tools.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Why C++17</h2>
<p>Historically, TEC targets C++17 because it matches the current minimum supported standard of gRPC's official C++ implementation. The TEC library deliberately avoids C++20+ features (concepts, modules, ranges, std::format, etc.) to maximize compatibility.</p>
<p>For missing standard library utilities (e.g. <code>std::format</code>, <code>std::print</code>), TEC provides very simple replacements such as: <code><a class="el" href="tec__print_8hpp.html#a9a8ea0398a13ec330d72d207d0bb46b2" title="Formats a single argument into a string.">tec::format</a></code>, <code><a class="el" href="tec__print_8hpp.html#ab2c82cf31ed8c45bbf639d23db90ddaf" title="Outputs a single argument to the specified stream.">tec::print</a></code>, <code><a class="el" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da" title="Outputs a single argument to the specified stream with a newline.">tec::println</a></code> (see <a href="https://olddeuteronomy.github.io/tec/html/tec__print_8hpp.html">tec_print.hpp</a> for more details).</p>
<p>You can still compile TEC with C++20 or C++23 compilers â€” the library remains fully header-only and template-based, so it adapts to newer language features when you use them in your own code.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Core Abstractions</h1>
<p>While TEC was born to improve <a class="el" href="dir_68db02de3583aeddd1f808b74ff83520.html">gRPC</a> ergonomics, its <em>abstractions</em> turned out to be very useful in many other multithreaded contexts.</p>
<p>TEC provides a small but powerful set of cooperating class templates that model different concurrency and service patterns.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Daemon</h2>
<p><code>Daemon</code> is an <b>abstract base interface</b> that defines the minimal contract for any long-lived service or processing component.</p>
<p>A daemon is a process or thread that runs continuously in the background and handles periodic service messages and requests. This interface defines the minimum set of methods and signals that a derived class must implement, including starting, terminating, sending messages, requests (RPC-style communication), and signaling state changes.</p>
<ul>
<li><code>run</code> &mdash; initiates the daemon's background process or thread.</li>
<li><code>terminate</code> &mdash; stops the daemon's background process or thread.</li>
<li><code>send</code> &mdash; allows external components to send a message to the daemon for processing.</li>
<li><code>make_request</code> &mdash; sends a request and <b>waits</b> for a reply in a daemon process/thread (RPC-style communication).</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">// tec_daemon.hpp</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__status_8hpp.html">tec/tec_status.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__message_8hpp.html">tec/tec_message.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__signal_8hpp.html">tec/tec_signal.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>Daemon {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// Ctors/dtor are omitted for clarity and conciseness.</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> Status run() = 0;</div>
<div class="line">    <span class="keyword">virtual</span> Status terminate() = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keyword">const</span> Signal&amp; sig_running() <span class="keyword">const</span> = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keyword">const</span> Signal&amp; sig_inited() <span class="keyword">const</span> = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keyword">const</span> Signal&amp; sig_terminated() <span class="keyword">const</span> = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> send(Message&amp;&amp; msg) = 0</div>
<div class="line">    <span class="keyword">virtual</span> Status make_request(Request&amp;&amp;, Reply&amp;&amp;) = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TRequest, <span class="keyword">typename</span> TReply&gt;</div>
<div class="line">    Status request(<span class="keyword">const</span> TRequest* req, TReply* rep) {</div>
<div class="line">        <span class="keywordflow">return</span> make_request({req}, {rep});</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Derived&gt;</div>
<div class="line">    <span class="keyword">struct </span>Builder {</div>
<div class="line">        std::unique_ptr&lt;Daemon&gt; operator()(<span class="keyword">typename</span> Derived::Params <span class="keyword">const</span>&amp; params) {</div>
<div class="line">            <span class="keyword">static_assert</span>(std::is_base_of&lt;Daemon, Derived&gt;::value,</div>
<div class="line">                          <span class="stringliteral">&quot;Derived type must inherit from tec::Daemon&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> std::make_unique&lt;Derived&gt;(params);</div>
<div class="line">        }</div>
<div class="line">    };</div>
<div class="line">};</div>
<div class="ttc" id="atec__message_8hpp_html"><div class="ttname"><a href="tec__message_8hpp.html">tec_message.hpp</a></div><div class="ttdoc">Defines a flexible message type and helper functions for the tec namespace.</div></div>
<div class="ttc" id="atec__signal_8hpp_html"><div class="ttname"><a href="tec__signal_8hpp.html">tec_signal.hpp</a></div><div class="ttdoc">Defines a thread-safe signal implementation using mutex and condition variable.</div></div>
<div class="ttc" id="atec__status_8hpp_html"><div class="ttname"><a href="tec__status_8hpp.html">tec_status.hpp</a></div><div class="ttdoc">Defines error handling types and utilities for the tec namespace.</div></div>
</div><!-- fragment --><p> See the complete definition of <a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1Daemon.html">Daemon</a>.</p>
<p>See also</p>
<ul>
<li><a href="https://olddeuteronomy.github.io/tec/html/tec__message_8hpp.html">Message/Request/Reply</a>,</li>
<li><a href="https://olddeuteronomy.github.io/tec/html/structtec_1_1TStatus.html">Status</a>,</li>
<li><a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1Signal.html">Signal</a>.</li>
</ul>
<p>Most higher-level classes in TEC implement or compose <code>Daemon</code>.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Worker</h2>
<p><code>Worker</code> is a ready-to-use synchronous message-processing daemon.</p>
<p><img src="img/Worker.png" alt="" class="inline"/></p>
<p>Implements the Daemon interface to manage a worker thread that processes messages from a <a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1SafeQueue.html">SafeQueue</a>. It supports registering callbacks for specific message types, provides default initialization and exit callbacks, and manages thread lifecycle with signals for running, initialization, and termination.</p>
<p>Key features:</p>
<ul>
<li>Processes messages sequentially in a dedicated thread</li>
<li>Simple, predictable execution model</li>
<li>Often used as a building block inside more complex components</li>
</ul>
<p>Extends <a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1Daemon.html">Daemon</a> with:</p>
<ul>
<li><code>register_callback</code> &mdash; supports registering callbacks</li>
<li><code>on_init</code> &mdash; initialization (may start threads, open resources, etc.)</li>
<li><code>on_exit</code> &mdash; graceful shutdown</li>
</ul>
<p>See the complete definition of <a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1Worker.html">Worker</a>.</p>
<p>See also:</p>
<ul>
<li><a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1Daemon.html">Daemon</a></li>
<li><a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1SafeQueue.html">SafeQueue</a>.</li>
</ul>
<h3><a class="anchor" id="autotoc_md7"></a>
Example: TestWorker Common Header</h3>
<div class="fragment"><div class="line"><span class="comment">// worker.hpp</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__daemon_8hpp.html">tec/tec_daemon.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Worker parameters.</span></div>
<div class="line"><span class="keyword">struct </span>TestParams {</div>
<div class="line">    <span class="comment">// Add custom parameters.</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// A compound message.</span></div>
<div class="line"><span class="keyword">struct </span>Position {</div>
<div class="line">    <span class="keywordtype">int</span> x;</div>
<div class="line">    <span class="keywordtype">int</span> y;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Reference to the actual Worker implementation exposed as Daemon.</span></div>
<div class="line">std::unique_ptr&lt;tec::Daemon&gt; create_test_worker(<span class="keyword">const</span> TestParams&amp;);</div>
<div class="ttc" id="atec__daemon_8hpp_html"><div class="ttname"><a href="tec__daemon_8hpp.html">tec_daemon.hpp</a></div><div class="ttdoc">Defines the minimal contract for any long-lived service or processing component.</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8"></a>
Example: TestWorker Implementation</h3>
<div class="fragment"><div class="line"><span class="comment">// worker.cpp</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__worker_8hpp.html">tec/tec_worker.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;worker.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>TestWorker final: <span class="keyword">public</span> <a class="code hl_class" href="classtec_1_1Worker.html">tec::Worker</a>&lt;TestParams&gt; {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">explicit</span> TestWorker(<span class="keyword">const</span> TestParams&amp; params)</div>
<div class="line">        : tec::Worker&lt;TestParams&gt;(params)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Register callbacks.</span></div>
<div class="line">        register_callback&lt;TestWorker, int&gt;(<span class="keyword">this</span>,</div>
<div class="line">            &amp;TestWorker::process_int);</div>
<div class="line">        register_callback&lt;TestWorker, std::string&gt;(<span class="keyword">this</span>,</div>
<div class="line">            &amp;TestWorker::process_string);</div>
<div class="line">        register_callback&lt;TestWorker, Position&gt;(<span class="keyword">this</span>,</div>
<div class="line">            &amp;TestWorker::process_position);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">    <span class="comment">// Override if you need specific initialization.</span></div>
<div class="line">    <span class="comment">// Returns tec::Error::Kind::Ok by default.</span></div>
<div class="line">    <span class="comment">// Status on_init() override { ... }</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Override if you need specific exiting.</span></div>
<div class="line">    <span class="comment">// Returns tec::Error::Kind::Ok by default.</span></div>
<div class="line">    <span class="comment">// Status on_exit() override { ...  }</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Process `int` message.</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> process_int(<span class="keyword">const</span> <a class="code hl_typedef" href="tec__message_8hpp.html#a9a5f12105ec8d63130dc96ee5dac4e98">tec::Message</a>&amp; msg) {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> counter = std::any_cast&lt;int&gt;(msg);</div>
<div class="line">        <span class="comment">// Do something with `counter`...</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Process `std::string` message.</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> process_string(<span class="keyword">const</span> <a class="code hl_typedef" href="tec__message_8hpp.html#a9a5f12105ec8d63130dc96ee5dac4e98">tec::Message</a>&amp; msg) {</div>
<div class="line">        <span class="keyword">auto</span> str = std::any_cast&lt;std::string&gt;(msg);</div>
<div class="line">        <span class="comment">// Do something with `str`...</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Process `Position` message.</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> process_position(<span class="keyword">const</span> <a class="code hl_typedef" href="tec__message_8hpp.html#a9a5f12105ec8d63130dc96ee5dac4e98">tec::Message</a>&amp; msg) {</div>
<div class="line">        <span class="keyword">auto</span> pos = std::any_cast&lt;Position&gt;(msg);</div>
<div class="line">        <span class="comment">// Do something with `pos.x` and `pos.y`...</span></div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><span class="comment">//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><span class="comment">// Expose actual Worker implementation as Daemon.</span></div>
<div class="line"><span class="comment">//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><span class="comment">//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line">std::unique_ptr&lt;tec::Daemon&gt; create_test_worker(<span class="keyword">const</span> TestParams&amp; params)  {</div>
<div class="line">    <span class="keyword">auto</span> daemon{<a class="code hl_struct" href="structtec_1_1Daemon_1_1Builder.html">tec::Daemon::Builder&lt;TestWorker&gt;</a>{}(params)};</div>
<div class="line">    <span class="keywordflow">return</span> daemon;</div>
<div class="line">}</div>
<div class="ttc" id="aclasstec_1_1Worker_html"><div class="ttname"><a href="classtec_1_1Worker.html">tec::Worker</a></div><div class="ttdoc">A class implementing message processing as a daemon.</div><div class="ttdef"><b>Definition</b> tec_worker.hpp:70</div></div>
<div class="ttc" id="astructtec_1_1Daemon_1_1Builder_html"><div class="ttname"><a href="structtec_1_1Daemon_1_1Builder.html">tec::Daemon::Builder</a></div><div class="ttdoc">Factory for creating daemon instances.</div><div class="ttdef"><b>Definition</b> tec_daemon.hpp:170</div></div>
<div class="ttc" id="atec__message_8hpp_html_a9a5f12105ec8d63130dc96ee5dac4e98"><div class="ttname"><a href="tec__message_8hpp.html#a9a5f12105ec8d63130dc96ee5dac4e98">tec::Message</a></div><div class="ttdeci">std::any Message</div><div class="ttdoc">Type alias for a message that can hold any object.</div><div class="ttdef"><b>Definition</b> tec_message.hpp:43</div></div>
<div class="ttc" id="atec__worker_8hpp_html"><div class="ttname"><a href="tec__worker_8hpp.html">tec_worker.hpp</a></div><div class="ttdoc">Defines a worker class for processing messages in the tec namespace.</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md9"></a>
Example: Run TestWorker</h3>
<p>Key points:</p>
<ul>
<li>The actual TestWorker implementation is <b>decoupled</b> from the application code.</li>
<li>The compilation units <code>worker.cpp</code> and <code>run_test_worker.cpp</code> are <b>independent</b>.</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">// run_test_worker.cpp</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__daemon_8hpp.html">tec/tec_daemon.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;worker.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="structtec_1_1TStatus.html">tec::Status</a> run_test_worker() {</div>
<div class="line">    TestParams params{<span class="comment">/*...*/</span>};</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create a daemon.</span></div>
<div class="line">    <span class="keyword">auto</span> daemon = create_test_worker(params);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Start the daemon thread and check for an initialization error.</span></div>
<div class="line">    <span class="keyword">auto</span> status = daemon-&gt;run();</div>
<div class="line">    <span class="keywordflow">if</span>( !status ) {</div>
<div class="line">        <span class="keywordflow">return</span> status;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Send different messages.</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// `process_int` will be called in the Worker&#39;s thread.</span></div>
<div class="line">    daemon-&gt;send({7});</div>
<div class="line">    <span class="comment">// `process_string` will be called in the Worker&#39;s thread.</span></div>
<div class="line">    daemon-&gt;send({std::string(<span class="stringliteral">&quot;This is a string!&quot;</span>)});</div>
<div class="line">    <span class="comment">// `process_position` will be called in the Worker&#39;s thread.</span></div>
<div class="line">    daemon-&gt;send({Position{2034, 710}});</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Optional --- if we want to check an exit status.</span></div>
<div class="line">    <span class="keywordflow">return</span> daemon-&gt;terminate();</div>
<div class="line">}</div>
<div class="ttc" id="astructtec_1_1TStatus_html"><div class="ttname"><a href="structtec_1_1TStatus.html">tec::TStatus&lt; int, std::string &gt;</a></div></div>
</div><!-- fragment --><p>See <a href="https://github.com/olddeuteronomy/tec/blob/main/samples/worker/test_worker.cpp">test_worker.cpp</a> source code example.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Actor</h2>
<p><code>Actor</code> models an <b>asynchronous service</b> with clear lifecycle (<code>start</code>/<code>shutdown</code>) and <b>request-reply</b> semantics. <code>Actor</code> serves as the foundation for all actor implementations in the TEC framework.</p>
<p><img src="img/Actor.png" alt="" class="inline"/></p>
<ul>
<li>Runs its main loop in background thread(s)</li>
<li>Processes incoming requests via <code>process_request(...)</code></li>
<li>Ideal for stateful services, background workers, long-running computations</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">class </span>Actor {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// Ctors/dtor are omitted for clarity and conciseness.</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> start(Signal* sig_started, Status* status) = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> shutdown(Signal* sig_stopped) = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> Status process_request(Request request, Reply reply) = 0;</div>
<div class="line"> </div>
<div class="line">}; <span class="comment">// class Actor</span></div>
</div><!-- fragment --><p>See the complete definition of <a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1Actor.html">Actor</a>.</p>
<p>All concrete actors must inherit from this class and implement:</p>
<ul>
<li><code>start</code> â€“&ndash; asynchronous initialization with completion signal.</li>
<li><code>shutdown</code> â€“&ndash; graceful termination with completion signal.</li>
<li><code>process_request</code> â€“&ndash; core message handling logic.</li>
</ul>
<p>Actors are typically long-lived services (e.g., TCP and gRPC servers) that run in their own thread or event loop until explicitly shut down.</p>
<h3><a class="anchor" id="autotoc_md11"></a>
Example: Actor implementation</h3>
<div class="fragment"><div class="line"><span class="comment">// Server parameters.</span></div>
<div class="line"><span class="keyword">struct </span>ServerParams {</div>
<div class="line">    <span class="keywordtype">int</span> inc;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Implement the Server as an Actor.</span></div>
<div class="line"><span class="keyword">class </span>Server final: <span class="keyword">public</span> <a class="code hl_class" href="classtec_1_1Actor.html">tec::Actor</a> {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    ServerParams params_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    Server(<span class="keyword">const</span> ServerParams&amp; params)</div>
<div class="line">        : tec::Actor()</div>
<div class="line">        , params_{params}</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classtec_1_1Actor.html#a362a6a294543f90686ed0c75697c4d32">start</a>(<a class="code hl_class" href="classtec_1_1Signal.html">tec::Signal</a>* sig_started, <a class="code hl_class" href="structtec_1_1TStatus.html">tec::Status</a>* status)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="comment">// Does nothing, just set `sig_started` on exit.</span></div>
<div class="line">        <a class="code hl_struct" href="structtec_1_1Signal_1_1OnExit.html">tec::Signal::OnExit</a> on_exit{sig_started};</div>
<div class="line">        <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;Server started with {} ...&quot;</span>, *status);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classtec_1_1Actor.html#a99eec2efe421350ed8000f4b25933e2e">shutdown</a>(<a class="code hl_class" href="classtec_1_1Signal.html">tec::Signal</a>* sig_stopped)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="comment">// Does nothing, just set `sig_stopped` on exit.</span></div>
<div class="line">        <a class="code hl_struct" href="structtec_1_1Signal_1_1OnExit.html">tec::Signal::OnExit</a> on_exit{sig_stopped};</div>
<div class="line">        <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;Server stopped.&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// RPC-style request handler. Increments input character by ServerParams::inc</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code hl_class" href="structtec_1_1TStatus.html">tec::Status</a> <a class="code hl_function" href="classtec_1_1Actor.html#aa6cbf3c06e7ebbccdadaa2a5ed851739">process_request</a>(<a class="code hl_typedef" href="tec__message_8hpp.html#ac905c839f081b87377f26c0f2a0824d0">tec::Request</a> _request, <a class="code hl_typedef" href="tec__message_8hpp.html#a5de784b32e4bb620c4495a0413e118e7">tec::Reply</a> _reply)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="comment">// Check type match.</span></div>
<div class="line">        <span class="comment">// NOTE: Both `_request` and `_reply` contain *pointers* to input/output data.</span></div>
<div class="line">        <span class="comment">// NOTE: `_request` content is const!</span></div>
<div class="line">        <span class="keywordflow">if</span>( _request.type() != <span class="keyword">typeid</span>(<span class="keyword">const</span> ChrRequest*) ||</div>
<div class="line">            _reply.type() != <span class="keyword">typeid</span>(ChrReply*) ) {</div>
<div class="line">            <span class="keywordflow">return</span> {<a class="code hl_enumvalue" href="structtec_1_1Error.html#aa8e779eed4e02e4f62add303fba422b1ab4080bdf74febf04d578ff105cce9d3f">tec::Error::Kind::Unsupported</a>};</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Get pointers to actual data.</span></div>
<div class="line">        <span class="keyword">auto</span> request = std::any_cast&lt;const ChrRequest*&gt;(_request);</div>
<div class="line">        <span class="keyword">auto</span> reply = std::any_cast&lt;ChrReply*&gt;(_reply);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Increment a character.</span></div>
<div class="line">        reply-&gt;ch = request-&gt;ch + params().inc;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// OK</span></div>
<div class="line">        <span class="keywordflow">return</span> {};</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="ttc" id="aclasstec_1_1Actor_html"><div class="ttname"><a href="classtec_1_1Actor.html">tec::Actor</a></div><div class="ttdoc">Abstract base class defining the actor lifecycle and request handling interface.</div><div class="ttdef"><b>Definition</b> tec_actor.hpp:63</div></div>
<div class="ttc" id="aclasstec_1_1Actor_html_a362a6a294543f90686ed0c75697c4d32"><div class="ttname"><a href="classtec_1_1Actor.html#a362a6a294543f90686ed0c75697c4d32">tec::Actor::start</a></div><div class="ttdeci">virtual void start(Signal *sig_started, Status *status)=0</div><div class="ttdoc">Starts the actor's operation.</div></div>
<div class="ttc" id="aclasstec_1_1Actor_html_a99eec2efe421350ed8000f4b25933e2e"><div class="ttname"><a href="classtec_1_1Actor.html#a99eec2efe421350ed8000f4b25933e2e">tec::Actor::shutdown</a></div><div class="ttdeci">virtual void shutdown(Signal *sig_stopped)=0</div><div class="ttdoc">Initiates graceful shutdown of the actor.</div></div>
<div class="ttc" id="aclasstec_1_1Actor_html_aa6cbf3c06e7ebbccdadaa2a5ed851739"><div class="ttname"><a href="classtec_1_1Actor.html#aa6cbf3c06e7ebbccdadaa2a5ed851739">tec::Actor::process_request</a></div><div class="ttdeci">virtual Status process_request(Request request, Reply reply)=0</div><div class="ttdoc">Processes a single request and produces a reply.</div></div>
<div class="ttc" id="aclasstec_1_1Signal_html"><div class="ttname"><a href="classtec_1_1Signal.html">tec::Signal</a></div><div class="ttdoc">A thread-safe signal mechanism for inter-thread synchronization.</div><div class="ttdef"><b>Definition</b> tec_signal.hpp:44</div></div>
<div class="ttc" id="astructtec_1_1Error_html_aa8e779eed4e02e4f62add303fba422b1ab4080bdf74febf04d578ff105cce9d3f"><div class="ttname"><a href="structtec_1_1Error.html#aa8e779eed4e02e4f62add303fba422b1ab4080bdf74febf04d578ff105cce9d3f">tec::Error::Kind::Unsupported</a></div><div class="ttdeci">@ Unsupported</div><div class="ttdoc">The feature is unsupported.</div></div>
<div class="ttc" id="astructtec_1_1Signal_1_1OnExit_html"><div class="ttname"><a href="structtec_1_1Signal_1_1OnExit.html">tec::Signal::OnExit</a></div><div class="ttdoc">Helper struct to signal termination on exit.</div><div class="ttdef"><b>Definition</b> tec_signal.hpp:110</div></div>
<div class="ttc" id="atec__message_8hpp_html_a5de784b32e4bb620c4495a0413e118e7"><div class="ttname"><a href="tec__message_8hpp.html#a5de784b32e4bb620c4495a0413e118e7">tec::Reply</a></div><div class="ttdeci">std::any Reply</div><div class="ttdoc">Type alias for a reply object that can hold any object.</div><div class="ttdef"><b>Definition</b> tec_message.hpp:55</div></div>
<div class="ttc" id="atec__message_8hpp_html_ac905c839f081b87377f26c0f2a0824d0"><div class="ttname"><a href="tec__message_8hpp.html#ac905c839f081b87377f26c0f2a0824d0">tec::Request</a></div><div class="ttdeci">std::any Request</div><div class="ttdoc">Type alias for a request object that can hold any object.</div><div class="ttdef"><b>Definition</b> tec_message.hpp:49</div></div>
<div class="ttc" id="atec__print_8hpp_html_ac49b732037c57831802a8060d1d483da"><div class="ttname"><a href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a></div><div class="ttdeci">void println(std::ostream *out, const T &amp;arg)</div><div class="ttdoc">Outputs a single argument to the specified stream with a newline.</div><div class="ttdef"><b>Definition</b> tec_print.hpp:90</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md12"></a>
ActorWorker</h2>
<p><code>ActorWorker</code> combines the <b>actor model</b> (asynchronous lifecycle) with the <b>worker model</b> (synchronous RPC request handling via <code>Daemon</code> interface).</p>
<p><img src="img/ActorWorker.png" alt="" class="inline"/></p>
<ul>
<li>Starts the underlying <code>Actor</code> in a background thread during <code>on_init()</code></li>
<li>Forwards incoming <code>Payload</code> messages to <code>Actor::process_request()</code></li>
<li>Guarantees thread-safe, synchronous replies back to callers</li>
<li>Performs clean shutdown of the actor during <code>on_exit()</code></li>
</ul>
<p>It bridges the asynchronous <code>Actor</code> interface with the synchronous <code>Worker</code>/<code>Daemon</code> model.</p>
<p>See the complete definition of <a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1ActorWorker.html">ActorWorker</a>.</p>
<div class="fragment"><div class="line"><span class="comment">// tec_actor_worker.hpp</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> TParams, <span class="keyword">typename</span> TActor&gt;</div>
<div class="line"><span class="keyword">class </span>ActorWorker : <span class="keyword">public</span> Worker&lt;TParams&gt; {</div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">    <span class="comment">// Owned actor instance.</span></div>
<div class="line">    std::unique_ptr&lt;TActor&gt; actor_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="comment">// Thread in which the actor runs.</span></div>
<div class="line">    std::thread actor_thread_;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Internals.</span></div>
<div class="line">    Signal sig_started_;</div>
<div class="line">    Signal sig_stopped_;</div>
<div class="line">    Status status_started_;</div>
<div class="line">    Status status_stopped_;</div>
<div class="line">    std::mutex mtx_request_;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// Takes ownership of a fully constructed `TActor` instance.</span></div>
<div class="line">    <span class="comment">// Registers a callback to handle `Payload*` messages synchronously.</span></div>
<div class="line">    ActorWorker(<span class="keyword">const</span> Params&amp; params, std::unique_ptr&lt;TActor&gt; actor)</div>
<div class="line">        : Worker&lt;Params&gt;(params)</div>
<div class="line">        , actor_{std::move(actor)}</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">static_assert</span>(</div>
<div class="line">            std::is_base_of_v&lt;Actor, TActor&gt;,</div>
<div class="line">            <span class="stringliteral">&quot;ActorWorker::TActor must derive from tec::Actor&quot;</span>);</div>
<div class="line">        <span class="comment">// Register synchronous RPC request handler.</span></div>
<div class="line">        this-&gt;<span class="keyword">template</span> register_callback&lt;ActorWorker, Payload*&gt;(</div>
<div class="line">            <span class="keyword">this</span>, &amp;ActorWorker::on_request);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    ~ActorWorker()<span class="keyword"> override </span>{</div>
<div class="line">        <span class="keywordflow">if</span> (actor_thread_.joinable()) {</div>
<div class="line">            actor_thread_.join();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initializes the worker by starting the actor in a background thread.</span></div>
<div class="line">    <a class="code hl_typedef" href="tec__status_8hpp.html#a5c70a078a2ec14d3b1551cfce16dd46d">Status</a> on_init()<span class="keyword"> override </span>{</div>
<div class="line">        <span class="keywordflow">if</span> (actor_thread_.joinable()) {</div>
<div class="line">            <span class="keywordflow">return</span> {<span class="stringliteral">&quot;Actor is already running&quot;</span>, Error::Kind::RuntimeErr};</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Launch Actor in dedicated thread.</span></div>
<div class="line">        actor_thread_ = std::thread([<span class="keyword">this</span>] {</div>
<div class="line">            actor_-&gt;start(&amp;sig_started_, &amp;status_started_);</div>
<div class="line">        });</div>
<div class="line">        <span class="comment">// Block until startup completes.</span></div>
<div class="line">        sig_started_.wait();</div>
<div class="line">        <span class="keywordflow">return</span> status_started_;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initiates shutdown in a temporary thread to avoid deadlock if the actor</span></div>
<div class="line">    <span class="comment">// is blocked in `start()`. Waits for `sig_stopped_` and joins both threads.</span></div>
<div class="line">    <a class="code hl_typedef" href="tec__status_8hpp.html#a5c70a078a2ec14d3b1551cfce16dd46d">Status</a> on_exit()<span class="keyword"> override </span>{</div>
<div class="line">        <span class="keywordflow">if</span> (!actor_thread_.joinable()) {</div>
<div class="line">            <span class="keywordflow">return</span> {}; <span class="comment">// Already stopped</span></div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Launch Actor&#39;s shutdown in a separate thread.</span></div>
<div class="line">        std::thread shutdown_thread([<span class="keyword">this</span>] {</div>
<div class="line">            actor_-&gt;shutdown(&amp;sig_stopped_);</div>
<div class="line">        });</div>
<div class="line">        sig_stopped_.wait();</div>
<div class="line">        shutdown_thread.join();</div>
<div class="line">        actor_thread_.join();</div>
<div class="line">        <span class="keywordflow">return</span> {};</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Handles incoming `Payload` requests synchronously.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Called by the daemon when a message of type `Payload*` arrives.</span></div>
<div class="line">    <span class="comment">// Forwards the request to the actor and populates the reply.</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> on_request(<span class="keyword">const</span> Message&amp; msg) {</div>
<div class="line">        <span class="keyword">typename</span> Worker&lt;TParams&gt;::Lock lk{mtx_request_};</div>
<div class="line">        Signal::OnExit on_exit(payload-&gt;ready);</div>
<div class="line">        <span class="comment">// Dispatch Payload</span></div>
<div class="line">        <span class="keyword">auto</span> payload = std::any_cast&lt;Payload*&gt;(msg);</div>
<div class="line">        *(payload-&gt;status) = actor_-&gt;process_request(</div>
<div class="line">            std::move(payload-&gt;request),</div>
<div class="line">            std::move(payload-&gt;reply));</div>
<div class="line">    }</div>
<div class="ttc" id="atec__status_8hpp_html_a5c70a078a2ec14d3b1551cfce16dd46d"><div class="ttname"><a href="tec__status_8hpp.html#a5c70a078a2ec14d3b1551cfce16dd46d">tec::Status</a></div><div class="ttdeci">TStatus&lt; int, std::string &gt; Status</div><div class="ttdoc">Type alias for a default TStatus with int code and std::string description.</div><div class="ttdef"><b>Definition</b> tec_status.hpp:223</div></div>
</div><!-- fragment --><p>This is one of the most commonly used building blocks when integrating TEC with TCP, gRPC, and other services.</p>
<p>See also</p>
<ul>
<li><a href="https://olddeuteronomy.github.io/tec/html/structtec_1_1Payload.html">Payload</a></li>
<li><a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1Actor.html">Actor</a></li>
<li><a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1Worker.html">Worker</a></li>
<li><a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1Daemon.html">Daemon</a></li>
</ul>
<p>See <a href="https://github.com/olddeuteronomy/tec/blob/main/samples/worker/test_server.cpp">test_server.cpp</a> source code example.</p>
<h1><a class="anchor" id="autotoc_md13"></a>
General Purpose Building Blocks</h1>
<h2><a class="anchor" id="autotoc_md14"></a>
NetData</h2>
<p><code>NetData</code> provides efficient serialization and deserialization of various C++ types including scalars, strings, blobs, containers, maps and user-defined serializable objects. The format consists of ElemHeader + payload for each element, allowing flexible and relatively compact binary representation suitable for network transmission.</p>
<p><img src="img/NetData.png" alt="" class="inline"/></p>
<p>Key features:</p>
<ul>
<li>Compact wire format</li>
<li>No external dependencies</li>
<li>Supports strings, blobs, containers, POD types, custom structs via specialization</li>
<li>Very low overhead compared to protobuf / JSON for simple structs</li>
</ul>
<p>See the complete definition of <a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1NetData.html">NetData</a>.</p>
<p>See also</p>
<ul>
<li><a href="https://olddeuteronomy.github.io/tec/html/structtec_1_1NdTypes.html">NdTypes</a> &ndash; core type definitions and metadata for the NetData binary serialization format.</li>
</ul>
<h3><a class="anchor" id="autotoc_md15"></a>
Example: NetData Definitions</h3>
<div class="fragment"><div class="line"><span class="comment">// samples/test_data.hpp</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;list&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unordered_map&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__serialize_8hpp.html">tec/tec_serialize.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__json_8hpp.html">tec/tec_json.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__net__data_8hpp.html">tec/net/tec_net_data.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>test {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">constexpr</span> <span class="keyword">const</span> <span class="keywordtype">char</span> test_blob[]{</div>
<div class="line">    <span class="stringliteral">&quot;\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0A\x0B\x0C\x0D\x0F&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\0&quot;</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">constexpr</span> <span class="keyword">const</span> <span class="keywordtype">char</span> test_string[]{</div>
<div class="line">    <span class="stringliteral">&quot;This is a UTF-8 string: ðŸ˜€ Hello world!\0&quot;</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><span class="comment">*                             Persons</span></div>
<div class="line"><span class="comment"> *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>Person: <a class="code hl_struct" href="structtec_1_1Serializable.html">tec::Serializable</a>, <a class="code hl_struct" href="structtec_1_1JsonSerializable.html">tec::JsonSerializable</a> {</div>
<div class="line">    <span class="keyword">using </span>json = <a class="code hl_struct" href="structtec_1_1Json.html">tec::Json</a>;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* sep{<a class="code hl_variable" href="structtec_1_1Json.html#ade21fcf894df8aab2745795a846f783f">tec::Json::sep</a>};</div>
<div class="line"> </div>
<div class="line">    Person() {}</div>
<div class="line">    Person(<span class="keywordtype">short</span> _age, <span class="keyword">const</span> <span class="keywordtype">char</span>* _name, <span class="keyword">const</span> <span class="keywordtype">char</span>* _surname)</div>
<div class="line">        : age{_age}</div>
<div class="line">        , <a class="code hl_function" href="tec__message_8hpp.html#acd425e566f8f5b08fa56c961b30c2ca0">name</a>{_name}</div>
<div class="line">        , surname{_surname}</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Data section.</span></div>
<div class="line">    <span class="keywordtype">short</span> age;</div>
<div class="line">    std::string <a class="code hl_function" href="tec__message_8hpp.html#acd425e566f8f5b08fa56c961b30c2ca0">name</a>;</div>
<div class="line">    std::string surname;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classtec_1_1NetData.html">tec::NetData</a>&amp; store(<a class="code hl_class" href="classtec_1_1NetData.html">tec::NetData</a>&amp; nd)<span class="keyword"> const override </span>{</div>
<div class="line">        nd</div>
<div class="line">            &lt;&lt; age</div>
<div class="line">            &lt;&lt; <a class="code hl_function" href="tec__message_8hpp.html#acd425e566f8f5b08fa56c961b30c2ca0">name</a></div>
<div class="line">            &lt;&lt; surname</div>
<div class="line">            ;</div>
<div class="line">        <span class="keywordflow">return</span> nd;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classtec_1_1NetData.html">tec::NetData</a>&amp; load(<a class="code hl_class" href="classtec_1_1NetData.html">tec::NetData</a>&amp; nd)<span class="keyword"> override </span>{</div>
<div class="line">        nd</div>
<div class="line">            &gt;&gt; age</div>
<div class="line">            &gt;&gt; <a class="code hl_function" href="tec__message_8hpp.html#acd425e566f8f5b08fa56c961b30c2ca0">name</a></div>
<div class="line">            &gt;&gt; surname</div>
<div class="line">            ;</div>
<div class="line">        <span class="keywordflow">return</span> nd;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">friend</span> std::ostream&amp; operator &lt;&lt; (std::ostream&amp; os, <span class="keyword">const</span> Person&amp; p) {</div>
<div class="line">        <span class="keywordflow">return</span> os &lt;&lt; json{}(p);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    std::string to_json()<span class="keyword"> const override </span>{</div>
<div class="line">        std::ostringstream os;</div>
<div class="line">        os</div>
<div class="line">            &lt;&lt; json{}(age, <span class="stringliteral">&quot;age&quot;</span>) &lt;&lt; sep</div>
<div class="line">            &lt;&lt; json{}(<a class="code hl_function" href="tec__message_8hpp.html#acd425e566f8f5b08fa56c961b30c2ca0">name</a>, <span class="stringliteral">&quot;name&quot;</span>) &lt;&lt; sep</div>
<div class="line">            &lt;&lt; json{}(surname, <span class="stringliteral">&quot;surname&quot;</span>)</div>
<div class="line">            ;</div>
<div class="line">        <span class="keywordflow">return</span> os.str();</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><span class="comment">*          TestData (covers almost all serializable types)</span></div>
<div class="line"><span class="comment"> *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>TestData: <a class="code hl_struct" href="structtec_1_1NdRoot.html">tec::NdRoot</a>, <a class="code hl_struct" href="structtec_1_1JsonSerializable.html">tec::JsonSerializable</a> {</div>
<div class="line">    <span class="keyword">using </span>json = <a class="code hl_struct" href="structtec_1_1Json.html">tec::Json</a>;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">auto</span> sep{<a class="code hl_variable" href="structtec_1_1Json.html#ade21fcf894df8aab2745795a846f783f">tec::Json::sep</a>};</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Data section.</span></div>
<div class="line">    std::list&lt;int&gt; list;</div>
<div class="line">    <span class="keywordtype">short</span> i16;</div>
<div class="line">    <span class="keywordtype">int</span> i32;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> u64;</div>
<div class="line">    std::string str;</div>
<div class="line">    <span class="keywordtype">float</span> f32;</div>
<div class="line">    <span class="keywordtype">double</span> d64;</div>
<div class="line">    Person p;</div>
<div class="line">    <span class="keywordtype">long</span> <span class="keywordtype">double</span> d128;</div>
<div class="line">    <a class="code hl_class" href="classtec_1_1MemFile.html">tec::Blob</a> blob;</div>
<div class="line">    <span class="keywordtype">bool</span> b;</div>
<div class="line">    std::unordered_map&lt;int, Person&gt; map;</div>
<div class="line"> </div>
<div class="line">    TestData(): tec::NdRoot(0) {</div>
<div class="line">        i16 = 0;</div>
<div class="line">        i32 = 0;</div>
<div class="line">        u64 = 0.0;</div>
<div class="line">        f32 = 0.0f;</div>
<div class="line">        d64 = 0.0;</div>
<div class="line">        d128 = 0.0;</div>
<div class="line">        b = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">void</span> init(TestData&amp; d) {</div>
<div class="line">        <span class="comment">// Fill test data.</span></div>
<div class="line">        std::unordered_map&lt;int,Person&gt;</div>
<div class="line">            persons{</div>
<div class="line">            {1256, {31, <span class="stringliteral">&quot;Mary&quot;</span>, <span class="stringliteral">&quot;Smith&quot;</span>}},</div>
<div class="line">            {78, {39, <span class="stringliteral">&quot;Harry&quot;</span>, <span class="stringliteral">&quot;Long&quot;</span>}},</div>
<div class="line">            {375, {67, <span class="stringliteral">&quot;Kevin&quot;</span>, <span class="stringliteral">&quot;Longsdale&quot;</span>}},</div>
<div class="line">        };</div>
<div class="line"> </div>
<div class="line">        d.list = {1, 2, 3, 4};</div>
<div class="line">        d.i16 = 16;</div>
<div class="line">        d.i32 = 32;</div>
<div class="line">        d.u64 = 1767623391515;</div>
<div class="line">        d.str = test_string;</div>
<div class="line">        d.f32 = 3.14f;</div>
<div class="line">        d.d64 = 2.78;</div>
<div class="line">        d.p = {61, <span class="stringliteral">&quot;John&quot;</span>, <span class="stringliteral">&quot;Dow&quot;</span>};</div>
<div class="line">        d.d128 = 1.123456e102;</div>
<div class="line">        d.blob = {test_blob, strlen(test_blob)};</div>
<div class="line">        d.b = <span class="keyword">true</span>;</div>
<div class="line">        d.map = persons;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classtec_1_1NetData.html">tec::NetData</a>&amp; store(<a class="code hl_class" href="classtec_1_1NetData.html">tec::NetData</a>&amp; nd)<span class="keyword"> const override </span>{</div>
<div class="line">      nd</div>
<div class="line">          &lt;&lt; list</div>
<div class="line">          &lt;&lt; i16</div>
<div class="line">          &lt;&lt; i32</div>
<div class="line">          &lt;&lt; u64</div>
<div class="line">          &lt;&lt; str</div>
<div class="line">          &lt;&lt; f32</div>
<div class="line">          &lt;&lt; d64</div>
<div class="line">          &lt;&lt; p</div>
<div class="line">          &lt;&lt; d128</div>
<div class="line">          &lt;&lt; blob</div>
<div class="line">          &lt;&lt; b</div>
<div class="line">          &lt;&lt; map</div>
<div class="line">          ;</div>
<div class="line">      <span class="keywordflow">return</span> nd;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classtec_1_1NetData.html">tec::NetData</a>&amp; load(<a class="code hl_class" href="classtec_1_1NetData.html">tec::NetData</a>&amp; nd)<span class="keyword"> override </span>{</div>
<div class="line">        nd</div>
<div class="line">            &gt;&gt; list</div>
<div class="line">            &gt;&gt; i16</div>
<div class="line">            &gt;&gt; i32</div>
<div class="line">            &gt;&gt; u64</div>
<div class="line">            &gt;&gt; str</div>
<div class="line">            &gt;&gt; f32</div>
<div class="line">            &gt;&gt; d64</div>
<div class="line">            &gt;&gt; p</div>
<div class="line">            &gt;&gt; d128</div>
<div class="line">            &gt;&gt; blob</div>
<div class="line">            &gt;&gt; b</div>
<div class="line">            &gt;&gt; map</div>
<div class="line">            ;</div>
<div class="line">        <span class="keywordflow">return</span> nd;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">friend</span> std::ostream&amp; operator &lt;&lt; (std::ostream&amp; os, <span class="keyword">const</span> TestData&amp; p) {</div>
<div class="line">        <span class="keywordflow">return</span> os &lt;&lt; <a class="code hl_struct" href="structtec_1_1Json.html">tec::Json</a>{}(p);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    std::string to_json()<span class="keyword"> const override </span>{</div>
<div class="line">        std::ostringstream os;</div>
<div class="line">        os</div>
<div class="line">            &lt;&lt; json{}(list, <span class="stringliteral">&quot;list&quot;</span>) &lt;&lt; sep</div>
<div class="line">            &lt;&lt; json{}(i16, <span class="stringliteral">&quot;i16&quot;</span>) &lt;&lt; sep</div>
<div class="line">            &lt;&lt; json{}(i32, <span class="stringliteral">&quot;i32&quot;</span>) &lt;&lt; sep</div>
<div class="line">            &lt;&lt; json{}(u64, <span class="stringliteral">&quot;u64&quot;</span>) &lt;&lt; sep</div>
<div class="line">            &lt;&lt; json{}(str, <span class="stringliteral">&quot;str&quot;</span>) &lt;&lt; sep</div>
<div class="line">            &lt;&lt; json{}(f32, <span class="stringliteral">&quot;f32&quot;</span>) &lt;&lt; sep</div>
<div class="line">            &lt;&lt; json{}(d64, <span class="stringliteral">&quot;d64&quot;</span>) &lt;&lt; sep</div>
<div class="line">            &lt;&lt; json{}(p, <span class="stringliteral">&quot;person&quot;</span>) &lt;&lt; sep</div>
<div class="line">            &lt;&lt; json{}(d128, <span class="stringliteral">&quot;d128&quot;</span>) &lt;&lt; sep</div>
<div class="line">            &lt;&lt; json{}(blob, <span class="stringliteral">&quot;bytes&quot;</span>) &lt;&lt; sep</div>
<div class="line">            &lt;&lt; json{}(b, <span class="stringliteral">&quot;b&quot;</span>) &lt;&lt; sep</div>
<div class="line">            &lt;&lt; json{}(map, <span class="stringliteral">&quot;persons&quot;</span>)</div>
<div class="line">            ;</div>
<div class="line">        <span class="keywordflow">return</span> os.str();</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><span class="comment">*                         GetPersons RPC structs</span></div>
<div class="line"><span class="comment"> *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Used to register an RPC handler in SocketServerNd.</span></div>
<div class="line"><span class="keyword">struct </span>RPCID {</div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keyword">static</span> <a class="code hl_typedef" href="tec__serialize_8hpp.html#a5200d83c9fc1eacce6e511854c1a7d44">tec::rpcid_t</a> GetPersons{1};</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Request</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keyword">struct </span>GetPersonsIn: <a class="code hl_struct" href="structtec_1_1NdRoot.html">tec::NdRoot</a>, <a class="code hl_struct" href="structtec_1_1JsonSerializable.html">tec::JsonSerializable</a> {</div>
<div class="line">    <span class="keyword">using </span>json = <a class="code hl_struct" href="structtec_1_1Json.html">tec::Json</a>;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">auto</span> sep{<a class="code hl_variable" href="structtec_1_1Json.html#ade21fcf894df8aab2745795a846f783f">tec::Json::sep</a>};</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Input data.</span></div>
<div class="line">    <span class="keywordtype">int</span> max_count;</div>
<div class="line"> </div>
<div class="line">    GetPersonsIn()</div>
<div class="line">        : tec::NdRoot(RPCID::GetPersons)  <span class="comment">// Request ID.</span></div>
<div class="line">        , max_count{0}       <span class="comment">// Get all records.</span></div>
<div class="line">        {}</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classtec_1_1NetData.html">tec::NetData</a>&amp; store(<a class="code hl_class" href="classtec_1_1NetData.html">tec::NetData</a>&amp; nd)<span class="keyword"> const override </span>{</div>
<div class="line">        <span class="keywordflow">return</span> nd &lt;&lt; max_count;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classtec_1_1NetData.html">tec::NetData</a>&amp; load(<a class="code hl_class" href="classtec_1_1NetData.html">tec::NetData</a>&amp; nd)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="keywordflow">return</span> nd &gt;&gt; max_count;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">friend</span> std::ostream&amp; operator &lt;&lt; (std::ostream&amp; os, <span class="keyword">const</span> GetPersonsIn&amp; p) {</div>
<div class="line">        <span class="keywordflow">return</span> os &lt;&lt; json{}(p);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    std::string to_json()<span class="keyword"> const override </span>{</div>
<div class="line">        std::ostringstream os;</div>
<div class="line">        os</div>
<div class="line">            &lt;&lt; json{}(max_count, <span class="stringliteral">&quot;max_count&quot;</span>)</div>
<div class="line">            ;</div>
<div class="line">        <span class="keywordflow">return</span> os.str();</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Reply</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keyword">struct </span>GetPersonsOut: <a class="code hl_struct" href="structtec_1_1NdRoot.html">tec::NdRoot</a>, <a class="code hl_struct" href="structtec_1_1JsonSerializable.html">tec::JsonSerializable</a> {</div>
<div class="line">    <span class="keyword">using </span>json = <a class="code hl_struct" href="structtec_1_1Json.html">tec::Json</a>;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">auto</span> sep{<a class="code hl_variable" href="structtec_1_1Json.html#ade21fcf894df8aab2745795a846f783f">tec::Json::sep</a>};</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Output data.</span></div>
<div class="line">    std::list&lt;Person&gt; persons;</div>
<div class="line"> </div>
<div class="line">    GetPersonsOut()</div>
<div class="line">        : tec::NdRoot(RPCID::GetPersons) <span class="comment">// Reply ID MUST BE EQUAL TO Request ID.</span></div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">     <a class="code hl_class" href="classtec_1_1NetData.html">tec::NetData</a>&amp; store(<a class="code hl_class" href="classtec_1_1NetData.html">tec::NetData</a>&amp; nd)<span class="keyword"> const override </span>{</div>
<div class="line">        <span class="keywordflow">return</span> nd &lt;&lt; persons;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classtec_1_1NetData.html">tec::NetData</a>&amp; load(<a class="code hl_class" href="classtec_1_1NetData.html">tec::NetData</a>&amp; nd)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="keywordflow">return</span> nd &gt;&gt; persons;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">friend</span> std::ostream&amp; operator &lt;&lt; (std::ostream&amp; os, <span class="keyword">const</span> GetPersonsOut&amp; p) {</div>
<div class="line">        <span class="keywordflow">return</span> os &lt;&lt; json{}(p);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    std::string to_json()<span class="keyword"> const override </span>{</div>
<div class="line">        std::ostringstream os;</div>
<div class="line">        os</div>
<div class="line">            &lt;&lt; json{}(persons, <span class="stringliteral">&quot;persons&quot;</span>)</div>
<div class="line">            ;</div>
<div class="line">        <span class="keywordflow">return</span> os.str();</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace test</span></div>
<div class="ttc" id="aclasstec_1_1MemFile_html"><div class="ttname"><a href="classtec_1_1MemFile.html">tec::MemFile</a></div><div class="ttdoc">A byte buffer class with stream-like read/write semantics.</div><div class="ttdef"><b>Definition</b> tec_memfile.hpp:50</div></div>
<div class="ttc" id="aclasstec_1_1NetData_html"><div class="ttname"><a href="classtec_1_1NetData.html">tec::NetData</a></div><div class="ttdoc">Lightweight binary serialization container optimized for network communication.</div><div class="ttdef"><b>Definition</b> tec_net_data.hpp:51</div></div>
<div class="ttc" id="astructtec_1_1JsonSerializable_html"><div class="ttname"><a href="structtec_1_1JsonSerializable.html">tec::JsonSerializable</a></div><div class="ttdoc">Base interface for objects that support JSON serialization.</div><div class="ttdef"><b>Definition</b> tec_serialize.hpp:169</div></div>
<div class="ttc" id="astructtec_1_1Json_html"><div class="ttname"><a href="structtec_1_1Json.html">tec::Json</a></div><div class="ttdoc">Utility class for generating minimal, valid JSON strings at compile-time and runtime.</div><div class="ttdef"><b>Definition</b> tec_json.hpp:62</div></div>
<div class="ttc" id="astructtec_1_1Json_html_ade21fcf894df8aab2745795a846f783f"><div class="ttname"><a href="structtec_1_1Json.html#ade21fcf894df8aab2745795a846f783f">tec::Json::sep</a></div><div class="ttdeci">static constexpr char sep[]</div><div class="ttdoc">Separator used between array/object elements.</div><div class="ttdef"><b>Definition</b> tec_json.hpp:65</div></div>
<div class="ttc" id="astructtec_1_1NdRoot_html"><div class="ttname"><a href="structtec_1_1NdRoot.html">tec::NdRoot</a></div><div class="ttdoc">Root class for serializable objects used in RPC communications.</div><div class="ttdef"><b>Definition</b> tec_serialize.hpp:119</div></div>
<div class="ttc" id="astructtec_1_1Serializable_html"><div class="ttname"><a href="structtec_1_1Serializable.html">tec::Serializable</a></div><div class="ttdoc">Base interface for objects that support binary and JSON serialization.</div><div class="ttdef"><b>Definition</b> tec_serialize.hpp:60</div></div>
<div class="ttc" id="atec__json_8hpp_html"><div class="ttname"><a href="tec__json_8hpp.html">tec_json.hpp</a></div><div class="ttdoc">Simple JSON serialization.</div></div>
<div class="ttc" id="atec__message_8hpp_html_acd425e566f8f5b08fa56c961b30c2ca0"><div class="ttname"><a href="tec__message_8hpp.html#acd425e566f8f5b08fa56c961b30c2ca0">tec::name</a></div><div class="ttdeci">auto name(const Message &amp;msg) noexcept</div><div class="ttdoc">Retrieves the type name of a message's content for registering the corresponding message handler.</div><div class="ttdef"><b>Definition</b> tec_message.hpp:84</div></div>
<div class="ttc" id="atec__net__data_8hpp_html"><div class="ttname"><a href="tec__net__data_8hpp.html">tec_net_data.hpp</a></div><div class="ttdoc">Lightweight binary serialization optimized for network communication.</div></div>
<div class="ttc" id="atec__serialize_8hpp_html"><div class="ttname"><a href="tec__serialize_8hpp.html">tec_serialize.hpp</a></div><div class="ttdoc">The base interface for serializable objects.</div></div>
<div class="ttc" id="atec__serialize_8hpp_html_a5200d83c9fc1eacce6e511854c1a7d44"><div class="ttname"><a href="tec__serialize_8hpp.html#a5200d83c9fc1eacce6e511854c1a7d44">tec::rpcid_t</a></div><div class="ttdeci">uint16_t rpcid_t</div><div class="ttdoc">Type alias for RPC identifiers, represented as a 16-bit unsigned integer.</div><div class="ttdef"><b>Definition</b> tec_serialize.hpp:108</div></div>
</div><!-- fragment --><p>See the complete <a href="https://github.com/olddeuteronomy/tec/blob/main/samples/test_data.hpp">example</a>.</p>
<h3><a class="anchor" id="autotoc_md16"></a>
Example: The Use of NetData</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;cstdio&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__dump_8hpp.html">tec/tec_dump.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__net__data_8hpp.html">tec/net/tec_net_data.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__nd__compress_8hpp.html">tec/net/tec_nd_compress.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;../test_data.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> print_data(<span class="keyword">const</span> test::TestData&amp; data) {</div>
<div class="line">    std::cout &lt;&lt; data &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> print_nd(<span class="keyword">const</span> <a class="code hl_class" href="classtec_1_1NetData.html">tec::NetData</a>&amp; nd) {</div>
<div class="line">    std::cout</div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;HEADER ===================================\n&quot;</span></div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;Magic:   &quot;</span> &lt;&lt; std::hex &lt;&lt; nd.<a class="code hl_variable" href="classtec_1_1NetData.html#abd13989e321cb6e44f0b439865f9c3ef">header</a>.<a class="code hl_variable" href="structtec_1_1NdTypes_1_1Header.html#ade212a32d89cec7f76a68758ccf8b297">magic</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;Version: &quot;</span> &lt;&lt; nd.<a class="code hl_variable" href="classtec_1_1NetData.html#abd13989e321cb6e44f0b439865f9c3ef">header</a>.<a class="code hl_variable" href="structtec_1_1NdTypes_1_1Header.html#a09050bf96b6d08f8fa3386d32c85b149">version</a> &lt;&lt; std::dec &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;ID:      &quot;</span> &lt;&lt; nd.<a class="code hl_variable" href="classtec_1_1NetData.html#abd13989e321cb6e44f0b439865f9c3ef">header</a>.<a class="code hl_variable" href="structtec_1_1NdTypes_1_1Header.html#add522d754a25f61e358cca82eeee7417">id</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;Size:    &quot;</span> &lt;&lt; nd.<a class="code hl_variable" href="classtec_1_1NetData.html#abd13989e321cb6e44f0b439865f9c3ef">header</a>.<a class="code hl_variable" href="structtec_1_1NdTypes_1_1Header.html#afc1b6cbe3ddb79fac2796011a8c55c4a">size</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;Orig:    &quot;</span> &lt;&lt; nd.<a class="code hl_variable" href="classtec_1_1NetData.html#abd13989e321cb6e44f0b439865f9c3ef">header</a>.<a class="code hl_variable" href="structtec_1_1NdTypes_1_1Header.html#a67d321fdf863cc3917514216f5f9b071">size_uncompressed</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;=========================================\n&quot;</span></div>
<div class="line">        ;</div>
<div class="line">    std::cout &lt;&lt; tec::dump::as_table(nd.<a class="code hl_function" href="classtec_1_1NetData.html#abd7ba3687923676ae37fe40152ee16f1">bytes</a>().<a class="code hl_function" href="classtec_1_1MemFile.html#ab700f42204ff022a139d2bbe6f3481f7">as_hex</a>()) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    test::TestData data;</div>
<div class="line">    test::TestData::init(data);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Store data.</span></div>
<div class="line">    <a class="code hl_class" href="classtec_1_1NetData.html">tec::NetData</a> nd_in;</div>
<div class="line">    print_data(data);</div>
<div class="line">    nd_in &lt;&lt; data;</div>
<div class="line">    print_nd(nd_in);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Compressing. Use `make ... ZLIB=1` to enable Zlib compression.</span></div>
<div class="line">    <a class="code hl_class" href="classtec_1_1NdCompress.html">tec::NdCompress</a> comp(tec::CompressionParams::kCompressionZlib);</div>
<div class="line">    comp.compress(nd_in);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Emulate NetData transferring...</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code hl_class" href="classtec_1_1NetData.html">tec::NetData</a> nd_out;</div>
<div class="line">    nd_out.<a class="code hl_function" href="classtec_1_1NetData.html#a0d323e2cb4db7f52827d997b89078269">copy_from</a>(nd_in);</div>
<div class="line">    print_nd(nd_out);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Uncompressing. Use `make ... ZLIB=1` to enable Zlib uncompression.</span></div>
<div class="line">    <a class="code hl_class" href="classtec_1_1NdCompress.html">tec::NdCompress</a> uncomp;</div>
<div class="line">    uncomp.<a class="code hl_function" href="classtec_1_1NdCompress.html#a77e93b1415aa6a1ced6655e9a843f2ef">uncompress</a>(nd_out);</div>
<div class="line">    print_nd(nd_out);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Restore data.</span></div>
<div class="line">    test::TestData data_out;</div>
<div class="line">    nd_out.<a class="code hl_function" href="classtec_1_1NetData.html#a6cbce7f835f9fa5fe215c9f4689c88b2">rewind</a>(); <span class="comment">// To ensure we&#39;re reading from the beginning.</span></div>
<div class="line">    nd_out &gt;&gt; data_out;</div>
<div class="line">    print_data(data_out);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclasstec_1_1MemFile_html_ab700f42204ff022a139d2bbe6f3481f7"><div class="ttname"><a href="classtec_1_1MemFile.html#ab700f42204ff022a139d2bbe6f3481f7">tec::MemFile::as_hex</a></div><div class="ttdeci">std::string as_hex() const</div><div class="ttdoc">Returns a human-readable hex+ASCII dump string.</div><div class="ttdef"><b>Definition</b> tec_memfile.hpp:456</div></div>
<div class="ttc" id="aclasstec_1_1NdCompress_html"><div class="ttname"><a href="classtec_1_1NdCompress.html">tec::NdCompress</a></div><div class="ttdoc">Compression wrapper for NetData objects with pluggable backends.</div><div class="ttdef"><b>Definition</b> tec_nd_compress.hpp:89</div></div>
<div class="ttc" id="aclasstec_1_1NdCompress_html_a77e93b1415aa6a1ced6655e9a843f2ef"><div class="ttname"><a href="classtec_1_1NdCompress.html#a77e93b1415aa6a1ced6655e9a843f2ef">tec::NdCompress::uncompress</a></div><div class="ttdeci">virtual Status uncompress(NetData &amp;nd) const</div><div class="ttdoc">Decompresses the payload of a NetData object in-place (if compressed)</div><div class="ttdef"><b>Definition</b> tec_nd_compress.hpp:202</div></div>
<div class="ttc" id="aclasstec_1_1NetData_html_a0d323e2cb4db7f52827d997b89078269"><div class="ttname"><a href="classtec_1_1NetData.html#a0d323e2cb4db7f52827d997b89078269">tec::NetData::copy_from</a></div><div class="ttdeci">void copy_from(const NetData &amp;src)</div><div class="ttdoc">Performs deep copy of content from another NetData instance.</div><div class="ttdef"><b>Definition</b> tec_net_data.hpp:101</div></div>
<div class="ttc" id="aclasstec_1_1NetData_html_a6cbce7f835f9fa5fe215c9f4689c88b2"><div class="ttname"><a href="classtec_1_1NetData.html#a6cbce7f835f9fa5fe215c9f4689c88b2">tec::NetData::rewind</a></div><div class="ttdeci">void rewind()</div><div class="ttdoc">Resets read position to the beginning of the buffer.</div><div class="ttdef"><b>Definition</b> tec_net_data.hpp:119</div></div>
<div class="ttc" id="aclasstec_1_1NetData_html_abd13989e321cb6e44f0b439865f9c3ef"><div class="ttname"><a href="classtec_1_1NetData.html#abd13989e321cb6e44f0b439865f9c3ef">tec::NetData::header</a></div><div class="ttdeci">Header header</div><div class="ttdoc">Global message header.</div><div class="ttdef"><b>Definition</b> tec_net_data.hpp:54</div></div>
<div class="ttc" id="aclasstec_1_1NetData_html_abd7ba3687923676ae37fe40152ee16f1"><div class="ttname"><a href="classtec_1_1NetData.html#abd7ba3687923676ae37fe40152ee16f1">tec::NetData::bytes</a></div><div class="ttdeci">const Bytes &amp; bytes() const</div><div class="ttdoc">Returns const reference to internal byte buffer.</div><div class="ttdef"><b>Definition</b> tec_net_data.hpp:85</div></div>
<div class="ttc" id="astructtec_1_1NdTypes_1_1Header_html_a09050bf96b6d08f8fa3386d32c85b149"><div class="ttname"><a href="structtec_1_1NdTypes_1_1Header.html#a09050bf96b6d08f8fa3386d32c85b149">tec::NdTypes::Header::version</a></div><div class="ttdeci">uint16_t version</div><div class="ttdoc">Protocol version.</div><div class="ttdef"><b>Definition</b> tec_nd_types.hpp:143</div></div>
<div class="ttc" id="astructtec_1_1NdTypes_1_1Header_html_a67d321fdf863cc3917514216f5f9b071"><div class="ttname"><a href="structtec_1_1NdTypes_1_1Header.html#a67d321fdf863cc3917514216f5f9b071">tec::NdTypes::Header::size_uncompressed</a></div><div class="ttdeci">uint32_t size_uncompressed</div><div class="ttdoc">Original uncompressed payload size (for verification).</div><div class="ttdef"><b>Definition</b> tec_nd_types.hpp:147</div></div>
<div class="ttc" id="astructtec_1_1NdTypes_1_1Header_html_add522d754a25f61e358cca82eeee7417"><div class="ttname"><a href="structtec_1_1NdTypes_1_1Header.html#add522d754a25f61e358cca82eeee7417">tec::NdTypes::Header::id</a></div><div class="ttdeci">uint16_t id</div><div class="ttdoc">User-defined root object identifier.</div><div class="ttdef"><b>Definition</b> tec_nd_types.hpp:144</div></div>
<div class="ttc" id="astructtec_1_1NdTypes_1_1Header_html_ade212a32d89cec7f76a68758ccf8b297"><div class="ttname"><a href="structtec_1_1NdTypes_1_1Header.html#ade212a32d89cec7f76a68758ccf8b297">tec::NdTypes::Header::magic</a></div><div class="ttdeci">uint32_t magic</div><div class="ttdoc">Magic identifier (must match kMagic).</div><div class="ttdef"><b>Definition</b> tec_nd_types.hpp:141</div></div>
<div class="ttc" id="astructtec_1_1NdTypes_1_1Header_html_afc1b6cbe3ddb79fac2796011a8c55c4a"><div class="ttname"><a href="structtec_1_1NdTypes_1_1Header.html#afc1b6cbe3ddb79fac2796011a8c55c4a">tec::NdTypes::Header::size</a></div><div class="ttdeci">uint32_t size</div><div class="ttdoc">Total size of the serialized payload excluding this header (bytes).</div><div class="ttdef"><b>Definition</b> tec_nd_types.hpp:142</div></div>
<div class="ttc" id="atec__dump_8hpp_html"><div class="ttname"><a href="tec__dump_8hpp.html">tec_dump.hpp</a></div><div class="ttdoc">Debugging/inspecting helpers.</div></div>
<div class="ttc" id="atec__nd__compress_8hpp_html"><div class="ttname"><a href="tec__nd__compress_8hpp.html">tec_nd_compress.hpp</a></div><div class="ttdoc">Compression wrapper for NetData objects with pluggable backends.</div></div>
</div><!-- fragment --><p>See the complete <a href="https://github.com/olddeuteronomy/tec/blob/main/samples/net/test_netdata.cpp">example</a>.</p>
<p>See also:</p>
<ul>
<li><a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1NdCompress.html">NdCompress</a> &mdash; Compression wrapper for NetData objects with pluggable backends.</li>
</ul>
<h4><a class="anchor" id="autotoc_md17"></a>
NetData Dump</h4>
<pre>
// print_data(const test::TestData&amp; data) --- JSON output.
//
{"list": [1, 2, 3, 4], "i16": 16, "i32": 32, "u64": 1767623391515,
"str": "This is a UTF-8 string: ðŸ˜€ Hello world!", "f32": 3.14,
"d64": 2.78, "person": {"age": 61, "name": "John", "surname": "Dow"},
"d128": 1.12346e+102,
"bytes": "AQIDBAUGBwgJCgsMDQ9BQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsv",
"b": true, "persons": {375: {"age": 67, "name": "Kevin", "surname": "Longsdale"},
78: {"age": 39, "name": "Harry", "surname": "Long"},
1256: {"age": 31, "name": "Mary", "surname": "Smith"}}}
//
// print_nd(const tec::NetData&amp; nd) --- header + hex table.
//
HEADER ===================================
Magic:   41b00
Version: 100
ID:      0
Size:    517
Orig:    0
=========================================
offset|00  02  04  06  08  10  12  14  16  18  20  22  24  26  28  30
======|++--++--++--++--++--++--++--++--++--++--++--++--++--++--++--++--|
000000| O00FD0100000100 C00 0000000040003050400000001000100000003050400|
000032|0000010002000000030504000000010003000000030504000000010004000000|
000064|0205020000000100100003050400000001002000000004010800000001001B y|
000096|908E9B010000 A09 )0000000100 T h i s20 i s20 a20 U T F - 820 s t|
000128| r i n g :20F09F988020 H e l l o20 w o r l d !0607040000000100C3|
000160|F5 H @0707080000000100 =0AD7A3 p =06 @ O00 !00000001000205020000|
000192|000100 =00 A09040000000100 J o h n A09030000000100 D o w08071000|
000224|0000010000C8F3 &gt;D3DB h80 R AD7 r02 eAA8D B09 N000000010001020304|
000256|05060708090A0B0C0D0F A B C D E F G H I J K L M N O P Q R S T U V|
000288| W X Y Z a b c d e f g h i j k l m n o p q r s t u v w x y z 0 1|
000320| 2 3 4 5 6 7 8 9 + /050101000000010001 M00AA00000003000305040000|
000352|000100 w010000 O00 (00000001000205020000000100 C00 A090500000001|
000384|00 K e v i n A09090000000100 L o n g s d a l e0305040000000100 N|
000416|000000 O00 #00000001000205020000000100 '00 A09050000000100 H a r|
000448| r y A09040000000100 L o n g0305040000000100E8040000 O00 #000000|
000480|010002050200000001001F00 A09040000000100 M a r y A09050000000100|
000512| S m i t h|
</pre><p>See also:</p>
<ul>
<li><a href="https://olddeuteronomy.github.io/tec/html/structtec_1_1Json.html">JSON</a> &mdash; Utility class for generating minimal, valid JSON strings at compile-time and runtime.</li>
</ul>
<h2><a class="anchor" id="autotoc_md18"></a>
BSD Socket Wrappers</h2>
<p><img src="img/SocketParams.png" alt="" class="inline"/></p>
<ul>
<li><a href="https://olddeuteronomy.github.io/tec/html/structtec_1_1SocketParams.html">SocketParams</a> &mdash; Common parameters used for both client and server socket configuration.</li>
</ul>
<p>See also</p>
<ul>
<li><a href="https://olddeuteronomy.github.io/tec/html/structtec_1_1SocketServerParams.html">SocketServerParams</a></li>
<li><a href="https://olddeuteronomy.github.io/tec/html/structtec_1_1SocketClientParams.html">SocketClientParams</a></li>
</ul>
<p><img src="img/Socket.png" alt="" class="inline"/></p>
<ul>
<li><a href="https://olddeuteronomy.github.io/tec/html/structtec_1_1Socket.html">Socket</a> &mdash; Lightweight wrapper around a connected socket file descriptor.</li>
<li><a href="https://olddeuteronomy.github.io/tec/html/structtec_1_1SocketNd.html">SocketNd</a> &mdash; Specialized socket wrapper optimized for sending/receiving <a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1NetData.html">NetData</a> protocol messages.</li>
</ul>
<h1><a class="anchor" id="autotoc_md19"></a>
Networking Layer</h1>
<h2><a class="anchor" id="autotoc_md20"></a>
SocketServer</h2>
<p>Generic BSD socket server template using actor pattern with configurable parameters.</p>
<p>Supports both single-threaded (synchronous) and multi-threaded (thread-pool) modes. Implements the <em>CharStream</em> mode &ndash; text oriented (default echo server behavior).</p>
<p><img src="img/SocketServer.png" alt="" class="inline"/></p>
<p>Main responsibilities:</p>
<ul>
<li>address resolution &amp; binding</li>
<li>listening</li>
<li>accepting connections in a loop</li>
<li>dispatching client sockets either synchronously or via thread pool</li>
<li>graceful shutdown with proper socket closure</li>
</ul>
<p>See the complete definition of <a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1SocketServer.html">SocketServer</a>.</p>
<p>See also:</p>
<ul>
<li><a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1SocketServerNd.html">SocketServerNd</a> &mdash; a derived class implementing the <em>NetData</em> mode &mdash; binary protocol oriented.</li>
</ul>
<h3><a class="anchor" id="autotoc_md21"></a>
Example: TCP echo server</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;csignal&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/socket.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__print_8hpp.html">tec/tec_print.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__actor__worker_8hpp.html">tec/tec_actor_worker.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__socket__server_8hpp.html">tec/net/tec_socket_server.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><span class="comment">*                     A simplest TCP echo server</span></div>
<div class="line"><span class="comment">*   in the kModeCharStream mode (default, receives and sends strings)</span></div>
<div class="line"><span class="comment"> *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate core blocks.</span></div>
<div class="line"><span class="keyword">using </span>TCPParams = <a class="code hl_struct" href="structtec_1_1SocketServerParams.html">tec::SocketServerParams</a>;</div>
<div class="line"><span class="keyword">using </span>TCPServer = <a class="code hl_class" href="classtec_1_1SocketServer.html">tec::SocketServer&lt;TCPParams&gt;</a>;</div>
<div class="line"><span class="keyword">using </span>TCPServerWorker = <a class="code hl_class" href="classtec_1_1ActorWorker.html">tec::ActorWorker&lt;TCPParams, TCPServer&gt;</a>;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="classtec_1_1Signal.html">tec::Signal</a> sig_quit;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="structtec_1_1TStatus.html">tec::Status</a> tcp_server() {</div>
<div class="line">    <a class="code hl_struct" href="structtec_1_1SocketServerParams.html">tec::SocketServerParams</a> params;</div>
<div class="line">    <span class="comment">// Accepts both IPv4 and IPv6.</span></div>
<div class="line">    params.<a class="code hl_variable" href="structtec_1_1SocketParams.html#a5e2ed05a7d3a7c107c8070a9a1f2ea1f">addr</a> = <a class="code hl_variable" href="structtec_1_1SocketParams.html#ae49fb92f3fbabf9c03ab876b5f8cfab1">tec::SocketParams::kAnyAddrIP6</a>;</div>
<div class="line">    params.<a class="code hl_variable" href="structtec_1_1SocketParams.html#a0fb091fb13bfe5bb14eb9e1c107b91e2">family</a> = AF_INET6;</div>
<div class="line">    <span class="comment">// To accept IPv4 only:</span></div>
<div class="line">    <span class="comment">// params.addr = tec::SocketParams::kAnyAddr;</span></div>
<div class="line">    <span class="comment">// params.family = AF_INET;</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Use internal thread pool to process incoming connections.</span></div>
<div class="line">    <span class="comment">// `false` by default.</span></div>
<div class="line">    params.<a class="code hl_variable" href="structtec_1_1SocketServerParams.html#a80e106e34b383a1b70df0f7332cf8bc8">use_thread_pool</a> = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create TCP server as Daemon.</span></div>
<div class="line">    <span class="keyword">auto</span> srv{TCPServerWorker::Builder&lt;TCPServerWorker, TCPServer&gt;{}(params)};</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Run it and check for the result.</span></div>
<div class="line">    <span class="keyword">auto</span> status = srv-&gt;run();</div>
<div class="line">    <span class="keywordflow">if</span>( !status ) {</div>
<div class="line">        <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;run(): {}&quot;</span>, status);</div>
<div class="line">        <span class="keywordflow">return</span> status;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Wait for &lt;Ctrl-C&gt; pressed to terminate the server.</span></div>
<div class="line">    <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;\nPRESS &lt;Ctrl-C&gt; TO QUIT THE SERVER&quot;</span>);</div>
<div class="line">    sig_quit.<a class="code hl_function" href="classtec_1_1Signal.html#a860ddfd3248f3024a105527ec80b4b17">wait</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Terminate the server</span></div>
<div class="line">    status = srv-&gt;terminate();</div>
<div class="line">    <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <span class="comment">// Install Ctrl-C handler.</span></div>
<div class="line">    std::signal(SIGINT, [](<span class="keywordtype">int</span>){ sig_quit.<a class="code hl_function" href="classtec_1_1Signal.html#a117cf58d6581b8695abf2902afa753aa">set</a>(); });</div>
<div class="line">    <span class="comment">// Run the server.</span></div>
<div class="line">    <span class="keyword">auto</span> result = tcp_server();</div>
<div class="line">    <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;\nExited with {}&quot;</span>, result);</div>
<div class="line">    <span class="keywordflow">return</span> result.code.value_or(0);</div>
<div class="line">}</div>
<div class="ttc" id="aclasstec_1_1ActorWorker_html"><div class="ttname"><a href="classtec_1_1ActorWorker.html">tec::ActorWorker</a></div><div class="ttdoc">A Worker that owns and runs an Actor in a dedicated thread.</div><div class="ttdef"><b>Definition</b> tec_actor_worker.hpp:76</div></div>
<div class="ttc" id="aclasstec_1_1Signal_html_a117cf58d6581b8695abf2902afa753aa"><div class="ttname"><a href="classtec_1_1Signal.html#a117cf58d6581b8695abf2902afa753aa">tec::Signal::set</a></div><div class="ttdeci">void set()</div><div class="ttdoc">Sets the signal to the signaled state and notifies all waiting threads.</div><div class="ttdef"><b>Definition</b> tec_signal.hpp:72</div></div>
<div class="ttc" id="aclasstec_1_1Signal_html_a860ddfd3248f3024a105527ec80b4b17"><div class="ttname"><a href="classtec_1_1Signal.html#a860ddfd3248f3024a105527ec80b4b17">tec::Signal::wait</a></div><div class="ttdeci">void wait() const</div><div class="ttdoc">Waits indefinitely until the signal is set.</div><div class="ttdef"><b>Definition</b> tec_signal.hpp:85</div></div>
<div class="ttc" id="aclasstec_1_1SocketServer_html"><div class="ttname"><a href="classtec_1_1SocketServer.html">tec::SocketServer</a></div><div class="ttdoc">Generic BSD socket server template using actor pattern with configurable parameters.</div><div class="ttdef"><b>Definition</b> tec_socket_server.hpp:82</div></div>
<div class="ttc" id="astructtec_1_1SocketParams_html_a0fb091fb13bfe5bb14eb9e1c107b91e2"><div class="ttname"><a href="structtec_1_1SocketParams.html#a0fb091fb13bfe5bb14eb9e1c107b91e2">tec::SocketParams::family</a></div><div class="ttdeci">int family</div><div class="ttdoc">Address family (AF_INET, AF_INET6, AF_UNSPEC, ...).</div><div class="ttdef"><b>Definition</b> tec_socket.hpp:105</div></div>
<div class="ttc" id="astructtec_1_1SocketParams_html_a5e2ed05a7d3a7c107c8070a9a1f2ea1f"><div class="ttname"><a href="structtec_1_1SocketParams.html#a5e2ed05a7d3a7c107c8070a9a1f2ea1f">tec::SocketParams::addr</a></div><div class="ttdeci">std::string addr</div><div class="ttdoc">Target address or hostname.</div><div class="ttdef"><b>Definition</b> tec_socket.hpp:102</div></div>
<div class="ttc" id="astructtec_1_1SocketParams_html_ae49fb92f3fbabf9c03ab876b5f8cfab1"><div class="ttname"><a href="structtec_1_1SocketParams.html#ae49fb92f3fbabf9c03ab876b5f8cfab1">tec::SocketParams::kAnyAddrIP6</a></div><div class="ttdeci">static constexpr char kAnyAddrIP6[]</div><div class="ttdoc">IPv6 address to bind/accept connections from any interface.</div><div class="ttdef"><b>Definition</b> tec_socket.hpp:72</div></div>
<div class="ttc" id="astructtec_1_1SocketServerParams_html"><div class="ttname"><a href="structtec_1_1SocketServerParams.html">tec::SocketServerParams</a></div><div class="ttdoc">Parameters specific to server-side socket configuration.</div><div class="ttdef"><b>Definition</b> tec_socket.hpp:170</div></div>
<div class="ttc" id="astructtec_1_1SocketServerParams_html_a80e106e34b383a1b70df0f7332cf8bc8"><div class="ttname"><a href="structtec_1_1SocketServerParams.html#a80e106e34b383a1b70df0f7332cf8bc8">tec::SocketServerParams::use_thread_pool</a></div><div class="ttdeci">bool use_thread_pool</div><div class="ttdoc">Use the thread pool for handling accepted connections.</div><div class="ttdef"><b>Definition</b> tec_socket.hpp:205</div></div>
<div class="ttc" id="atec__actor__worker_8hpp_html"><div class="ttname"><a href="tec__actor__worker_8hpp.html">tec_actor_worker.hpp</a></div><div class="ttdoc">Template class combining Worker and Actor for synchronous request processing in a dedicated thread.</div></div>
<div class="ttc" id="atec__print_8hpp_html"><div class="ttname"><a href="tec__print_8hpp.html">tec_print.hpp</a></div><div class="ttdoc">Provides variadic print and format utilities for the tec namespace. Implemented for compatibility wit...</div></div>
<div class="ttc" id="atec__socket__server_8hpp_html"><div class="ttname"><a href="tec__socket__server_8hpp.html">tec_socket_server.hpp</a></div><div class="ttdoc">Generic BSD socket server template using actor pattern with configurable parameters.</div></div>
</div><!-- fragment --><p>See the complete <a href="https://github.com/olddeuteronomy/tec/blob/main/samples/socket/tcp_server.cpp">example</a>.</p>
<h2><a class="anchor" id="autotoc_md22"></a>
SocketClient</h2>
<p>Templated client socket actor for establishing and managing connections.</p>
<p><img src="img/SocketClient.png" alt="" class="inline"/></p>
<p>The <a href="doc/html/classtec_1_1SocketClient.html">SocketClient</a> class provides a mechanism to connect to a server using socket APIs, send and receive data (primarily strings via SocketCharStreamIn/Out), and handle actor lifecycle events like start and shutdown. It uses a template parameter for configuration, ensuring type safety through static assertion.</p>
<p>Key features:</p>
<ul>
<li>Resolves server addresses using getaddrinfo.</li>
<li>Establishes connections with fallback on multiple address candidates.</li>
<li>Supports sending and receiving null-terminated strings.</li>
<li>Provides virtual methods for customization (e.g., socket options, send/receive logic).</li>
<li>Integrates with Actor for signal-based start/stop and request processing.</li>
</ul>
<p>See the complete definition of <a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1SocketClient.html">SocketClient</a>.</p>
<p>See also:</p>
<ul>
<li><a href="https://olddeuteronomy.github.io/tec/html/structtec_1_1SocketCharStreamIn.html">SocketCharStreamIn</a> &mdash; Input descriptor for character stream mode.</li>
<li><a href="https://olddeuteronomy.github.io/tec/html/structtec_1_1SocketCharStreamOut.html">SocketCharStreamOut</a> &mdash; Output descriptor for character stream mode.</li>
</ul>
<h3><a class="anchor" id="autotoc_md23"></a>
Example: Socket Client</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/socket.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__def_8hpp.html">tec/tec_def.hpp</a>&quot;</span> <span class="comment">// IWYU pragma: keep</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__print_8hpp.html">tec/tec_print.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__actor__worker_8hpp.html">tec/tec_actor_worker.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__socket__client_8hpp.html">tec/net/tec_socket_client.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><span class="comment">*                     A simple TCP client</span></div>
<div class="line"><span class="comment"> *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate core blocks.</span></div>
<div class="line"><span class="keyword">using </span>TCPParams = <a class="code hl_struct" href="structtec_1_1SocketClientParams.html">tec::SocketClientParams</a>;</div>
<div class="line"><span class="keyword">using </span>TCPClient = <a class="code hl_class" href="classtec_1_1SocketClient.html">tec::SocketClient&lt;TCPParams&gt;</a>;</div>
<div class="line"><span class="keyword">using </span>TCPClientWorker = <a class="code hl_class" href="classtec_1_1ActorWorker.html">tec::ActorWorker&lt;TCPParams, TCPClient&gt;</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="structtec_1_1TStatus.html">tec::Status</a> tcp_client() {</div>
<div class="line">    <span class="comment">// By default, it can connect to either IPv4 or IPv6 tec::SocketServer.</span></div>
<div class="line">    TCPParams params;</div>
<div class="line">    <span class="comment">// To use IPv6 only (local server):</span></div>
<div class="line">    <span class="comment">//     params.addr = tec::SocketParams::kLocalAddrIP6;</span></div>
<div class="line">    <span class="comment">//     params.family = AF_INET6;</span></div>
<div class="line">    <span class="comment">// To use IPv4 only (local server):</span></div>
<div class="line">    <span class="comment">//     params.addr = tec::SocketParams::kLocalAddr;</span></div>
<div class="line">    <span class="comment">//     params.family = AF_INET4;</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Using Daemon interface.</span></div>
<div class="line">    <span class="keyword">auto</span> cli{TCPClientWorker::Builder&lt;TCPClientWorker, TCPClient&gt;{}(params)};</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Run it and check for the result.</span></div>
<div class="line">    <span class="keyword">auto</span> status = cli-&gt;run();</div>
<div class="line">    <span class="keywordflow">if</span>( !status ) {</div>
<div class="line">        <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;tcp_client: {}&quot;</span>, status);</div>
<div class="line">        <span class="keywordflow">return</span> status;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Data to process.</span></div>
<div class="line">    std::string str_send{<span class="stringliteral">&quot;Hello world!&quot;</span>};</div>
<div class="line">    std::string str_recv;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Make an RPC request using the Daemon API.</span></div>
<div class="line">    <a class="code hl_struct" href="structtec_1_1SocketCharStreamIn.html">tec::SocketCharStreamIn</a> req{&amp;str_send};</div>
<div class="line">    <a class="code hl_struct" href="structtec_1_1SocketCharStreamOut.html">tec::SocketCharStreamOut</a> rep{&amp;str_recv};</div>
<div class="line">    status = cli-&gt;request(&amp;req, &amp;rep);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>( !status ) {</div>
<div class="line">        <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;tcp_client: {}&quot;</span>, status);</div>
<div class="line">        <span class="keywordflow">return</span> status;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;SEND:\&quot;{}\&quot;&quot;</span>, str_send);</div>
<div class="line">    <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;RECV:\&quot;{}\&quot;&quot;</span>, str_recv);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Optionally.</span></div>
<div class="line">    cli-&gt;terminate();</div>
<div class="line">    <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <span class="comment">// Run the client.</span></div>
<div class="line">    <span class="keyword">auto</span> result = tcp_client();</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;\nExited with {}&quot;</span>, result);</div>
<div class="line">    <span class="keywordflow">return</span> result.code.value_or(0);</div>
<div class="line">}</div>
<div class="ttc" id="aclasstec_1_1SocketClient_html"><div class="ttname"><a href="classtec_1_1SocketClient.html">tec::SocketClient</a></div><div class="ttdoc">Templated client socket actor for establishing and managing connections.</div><div class="ttdef"><b>Definition</b> tec_socket_client.hpp:92</div></div>
<div class="ttc" id="astructtec_1_1SocketCharStreamIn_html"><div class="ttname"><a href="structtec_1_1SocketCharStreamIn.html">tec::SocketCharStreamIn</a></div><div class="ttdoc">Input descriptor for character stream mode.</div><div class="ttdef"><b>Definition</b> tec_socket.hpp:242</div></div>
<div class="ttc" id="astructtec_1_1SocketCharStreamOut_html"><div class="ttname"><a href="structtec_1_1SocketCharStreamOut.html">tec::SocketCharStreamOut</a></div><div class="ttdoc">Output descriptor for character stream mode.</div><div class="ttdef"><b>Definition</b> tec_socket.hpp:254</div></div>
<div class="ttc" id="astructtec_1_1SocketClientParams_html"><div class="ttname"><a href="structtec_1_1SocketClientParams.html">tec::SocketClientParams</a></div><div class="ttdoc">Parameters specific to client-side socket connections.</div><div class="ttdef"><b>Definition</b> tec_socket.hpp:145</div></div>
<div class="ttc" id="atec__def_8hpp_html"><div class="ttname"><a href="tec__def_8hpp.html">tec_def.hpp</a></div><div class="ttdoc">Common definitions and utilities for the tec namespace.</div></div>
<div class="ttc" id="atec__socket__client_8hpp_html"><div class="ttname"><a href="tec__socket__client_8hpp.html">tec_socket_client.hpp</a></div><div class="ttdoc">Definition of the SocketClient class template.</div></div>
</div><!-- fragment --><p>See the complete <a href="https://github.com/olddeuteronomy/tec/blob/main/samples/socket/tcp_client.cpp">example</a>.</p>
<h2><a class="anchor" id="autotoc_md24"></a>
SocketServerNd</h2>
<p>NetData-protocol-aware BSD socket server with request dispatching and optional compression.</p>
<p><img src="img/SocketServerNd.png" alt="" class="inline"/></p>
<p><a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1SocketServerNd.html">SocketServerNd</a> extends <a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1SocketServer.html">SocketServer</a> to handle the <a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1NetData.html">NetData</a> message framing protocol (header + payload) and provides:</p>
<ul>
<li>typed handler registration by NetData::ID</li>
<li>automatic compression/decompression (when enabled in params)</li>
<li>default echo handler (ID = 0)</li>
<li>structured error reply mechanism</li>
<li>fallback to raw string handling when message is not valid NetData</li>
</ul>
<p>See the complete definition of <a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1SocketServerNd.html">SocketServerNd</a>.</p>
<p>See also:</p>
<ul>
<li><a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1NetData.html">NetData</a></li>
<li><a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1NdCompress.html">NdCompress</a></li>
</ul>
<h3><a class="anchor" id="autotoc_md25"></a>
Example: NetData Server</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;csignal&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__def_8hpp.html">tec/tec_def.hpp</a>&quot;</span> <span class="comment">// IWYU pragma: keep</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__print_8hpp.html">tec/tec_print.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__trace_8hpp.html">tec/tec_trace.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__actor__worker_8hpp.html">tec/tec_actor_worker.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__net__data_8hpp.html">tec/net/tec_net_data.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__compression_8hpp.html">tec/net/tec_compression.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__socket__server__nd_8hpp.html">tec/net/tec_socket_server_nd.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// See Example in the NetData section.</span></div>
<div class="line"><span class="preprocessor">#include &quot;../test_data.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><span class="comment">*                      NetData TCP server</span></div>
<div class="line"><span class="comment"> *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using </span>TCPParams = <a class="code hl_struct" href="structtec_1_1SocketServerParams.html">tec::SocketServerParams</a>;</div>
<div class="line"><span class="keyword">using </span>TCPServer = <a class="code hl_class" href="classtec_1_1SocketServerNd.html">tec::SocketServerNd&lt;TCPParams&gt;</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">using </span>DataInOut = TCPServer::DataInOut;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate a server (as Actor).</span></div>
<div class="line"><span class="keyword">class </span>Server final: <span class="keyword">public</span> TCPServer {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    Server(<span class="keyword">const</span> TCPParams&amp; params)</div>
<div class="line">        : TCPServer(params)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Register NetData RPC GetPersons handler. See ../test_data.hpp.</span></div>
<div class="line">        register_handler(<span class="keyword">this</span>, test::RPCID::GetPersons, &amp;Server::on_persons);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> on_persons(DataInOut dio) {</div>
<div class="line">        <a class="code hl_define" href="group__TracerMacros.html#ga22ceef691c93794829defef074037bef">TEC_ENTER</a>(<span class="stringliteral">&quot;MyServer::on_persons&quot;</span>);</div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// Get request. (Not used in this sample.)</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        GetPersonsIn request;</div>
<div class="line">        *dio.nd_in &gt;&gt; request;</div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// Generate a reply...</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        GetPersonsOut reply;</div>
<div class="line">        reply.persons.push_back({67, <span class="stringliteral">&quot;John&quot;</span>, <span class="stringliteral">&quot;Dow&quot;</span>});</div>
<div class="line">        reply.persons.push_back({52, <span class="stringliteral">&quot;Boris&quot;</span>, <span class="stringliteral">&quot;Applegate&quot;</span>});</div>
<div class="line">        reply.persons.push_back({29, <span class="stringliteral">&quot;Lucy&quot;</span>, <span class="stringliteral">&quot;Skywalker&quot;</span>});</div>
<div class="line">        reply.persons.push_back({20, <span class="stringliteral">&quot;Harry&quot;</span>, <span class="stringliteral">&quot;Long&quot;</span>});</div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// ... and send it back to a client.</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        *dio.nd_out &lt;&lt; reply;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate an ActorWorker.</span></div>
<div class="line"><span class="keyword">using </span>TCPServerWorker = <a class="code hl_class" href="classtec_1_1ActorWorker.html">tec::ActorWorker&lt;TCPParams, Server&gt;</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><span class="comment">*                    Create and run the TCP server</span></div>
<div class="line"><span class="comment"> *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="classtec_1_1Signal.html">tec::Signal</a> sig_quit;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="structtec_1_1TStatus.html">tec::Status</a> tcp_server() {</div>
<div class="line">    <a class="code hl_struct" href="structtec_1_1SocketServerParams.html">tec::SocketServerParams</a> params;</div>
<div class="line">    <span class="comment">// To accept IPv6:</span></div>
<div class="line">    <span class="comment">// params.addr = tec::SocketParams::kAnyAddrIP6;</span></div>
<div class="line">    <span class="comment">// params.family = AF_INET6;</span></div>
<div class="line">    params.<a class="code hl_variable" href="structtec_1_1SocketServerParams.html#a30e4b239ca0736a420fb7f0b401ac500">mode</a> = <a class="code hl_variable" href="structtec_1_1SocketServerParams.html#a156e68a5c0150b626f968626d69b3b4e">tec::SocketServerParams::kModeNetData</a>;</div>
<div class="line">    params.<a class="code hl_variable" href="structtec_1_1SocketParams.html#ab08294f8ec6392ee60cc13564e20ecc9">compression</a> = tec::CompressionParams::kCompressionZlib;</div>
<div class="line">    params.<a class="code hl_variable" href="structtec_1_1SocketServerParams.html#a80e106e34b383a1b70df0f7332cf8bc8">use_thread_pool</a> = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create a daemon.</span></div>
<div class="line">    <span class="keyword">auto</span> srv{TCPServerWorker::Builder&lt;TCPServerWorker, Server&gt;{}(params)};</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Run it and check for the result.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keyword">auto</span> status = srv-&gt;run();</div>
<div class="line">    <span class="keywordflow">if</span>( !status ) {</div>
<div class="line">        <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;run(): {}&quot;</span>, status);</div>
<div class="line">        <span class="keywordflow">return</span> status;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Wait for &lt;Ctrl-C&gt; pressed to terminate the server.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;\nPRESS &lt;Ctrl-C&gt; TO QUIT THE SERVER&quot;</span>);</div>
<div class="line">    sig_quit.<a class="code hl_function" href="classtec_1_1Signal.html#a860ddfd3248f3024a105527ec80b4b17">wait</a>();</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Terminate the server (optionally).</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    status = srv-&gt;terminate();</div>
<div class="line">    <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><span class="comment">*                             MAIN</span></div>
<div class="line"><span class="comment"> *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <span class="comment">// Install Ctrl-C handler.</span></div>
<div class="line">    std::signal(SIGINT, [](<span class="keywordtype">int</span>){ sig_quit.<a class="code hl_function" href="classtec_1_1Signal.html#a117cf58d6581b8695abf2902afa753aa">set</a>(); });</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Run the test.</span></div>
<div class="line">    <span class="keyword">auto</span> result = tcp_server();</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;\nExited with {}&quot;</span>, result);</div>
<div class="line">    <span class="keywordflow">return</span> result.code.value_or(0);</div>
<div class="line">}</div>
<div class="ttc" id="aclasstec_1_1SocketServerNd_html"><div class="ttname"><a href="classtec_1_1SocketServerNd.html">tec::SocketServerNd</a></div><div class="ttdoc">NetData-protocol-aware TCP server with request dispatching and optional compression.</div><div class="ttdef"><b>Definition</b> tec_socket_server_nd.hpp:66</div></div>
<div class="ttc" id="agroup__TracerMacros_html_ga22ceef691c93794829defef074037bef"><div class="ttname"><a href="group__TracerMacros.html#ga22ceef691c93794829defef074037bef">TEC_ENTER</a></div><div class="ttdeci">#define TEC_ENTER(name)</div><div class="ttdoc">Disabled tracing macro for entry logging.</div><div class="ttdef"><b>Definition</b> tec_trace.hpp:191</div></div>
<div class="ttc" id="astructtec_1_1SocketParams_html_ab08294f8ec6392ee60cc13564e20ecc9"><div class="ttname"><a href="structtec_1_1SocketParams.html#ab08294f8ec6392ee60cc13564e20ecc9">tec::SocketParams::compression</a></div><div class="ttdeci">int compression</div><div class="ttdoc">Compression algorithm to use (see CompressionParams).</div><div class="ttdef"><b>Definition</b> tec_socket.hpp:109</div></div>
<div class="ttc" id="astructtec_1_1SocketServerParams_html_a156e68a5c0150b626f968626d69b3b4e"><div class="ttname"><a href="structtec_1_1SocketServerParams.html#a156e68a5c0150b626f968626d69b3b4e">tec::SocketServerParams::kModeNetData</a></div><div class="ttdeci">static constexpr int kModeNetData</div><div class="ttdoc">Treat incoming data as length-prefixed binary network messages.</div><div class="ttdef"><b>Definition</b> tec_socket.hpp:182</div></div>
<div class="ttc" id="astructtec_1_1SocketServerParams_html_a30e4b239ca0736a420fb7f0b401ac500"><div class="ttname"><a href="structtec_1_1SocketServerParams.html#a30e4b239ca0736a420fb7f0b401ac500">tec::SocketServerParams::mode</a></div><div class="ttdeci">int mode</div><div class="ttdoc">Data handling mode (character stream or binary network data).</div><div class="ttdef"><b>Definition</b> tec_socket.hpp:201</div></div>
<div class="ttc" id="atec__compression_8hpp_html"><div class="ttname"><a href="tec__compression_8hpp.html">tec_compression.hpp</a></div><div class="ttdoc">Compression parameters.</div></div>
<div class="ttc" id="atec__socket__server__nd_8hpp_html"><div class="ttname"><a href="tec__socket__server__nd_8hpp.html">tec_socket_server_nd.hpp</a></div><div class="ttdoc">NetData server.</div></div>
<div class="ttc" id="atec__trace_8hpp_html"><div class="ttname"><a href="tec__trace_8hpp.html">tec_trace.hpp</a></div><div class="ttdoc">Provides a thread-safe tracing utility for debugging in the tec namespace.</div></div>
</div><!-- fragment --><p>See the complete <a href="https://github.com/olddeuteronomy/tec/blob/main/samples/socket/tcp_server_nd.cpp">example</a>.</p>
<p>See also:</p>
<ul>
<li><a href="https://olddeuteronomy.github.io/tec/html/structtec_1_1SocketServerNd_1_1DataInOut.html">DataInOut</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md26"></a>
SocketClientNd</h2>
<p>Templated client socket <a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1Actor.html">Actor</a> for <a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1NetData.html">NetData</a> stream handling.</p>
<p><img src="img/SocketClientNd.png" alt="" class="inline"/></p>
<p>The <a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1SocketClientNd.html">SocketClientNd</a> class extends <a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1SocketClient.html">SocketClient</a> to support NetData-based requests and replies. It handles binary data transmission with optional compression, providing overrides for request processing and virtual methods for send/receive and data processing customization.</p>
<p>Key features:</p>
<ul>
<li>Processes <a href="doc/html/structtec_1_1NetData_1_1StreamIn.html">NetData::StreamIn</a> and <a href="doc/html/structtec_1_1NetData_1_1StreamOut.html">NetData::StreamOut</a> for structured data exchange.</li>
<li>Supports compression/uncompression based on parameters.</li>
<li>Integrates with <a href="https://olddeuteronomy.github.io/tec/html/structtec_1_1SocketNd.html">SocketNd</a> for low-level NetData socket operations.</li>
</ul>
<p>See the complete documentation of <a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1SocketClientNd.html">SocketClientNd</a>.</p>
<p>See also:</p>
<ul>
<li><a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1NetData.html">NetData</a></li>
<li><a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1NdCompress.html">NdCompress</a></li>
</ul>
<h3><a class="anchor" id="autotoc_md27"></a>
Example: NetData Client</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/socket.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__def_8hpp.html">tec/tec_def.hpp</a>&quot;</span> <span class="comment">// IWYU pragma: keep</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__print_8hpp.html">tec/tec_print.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__dump_8hpp.html">tec/tec_dump.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__actor__worker_8hpp.html">tec/tec_actor_worker.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__net__data_8hpp.html">tec/net/tec_net_data.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__socket__client__nd_8hpp.html">tec/net/tec_socket_client_nd.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// See Example in the NetData section.</span></div>
<div class="line"><span class="preprocessor">#include &quot;../test_data.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><span class="comment">*                       NetData TCP client</span></div>
<div class="line"><span class="comment"> *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instatiate core blocks.</span></div>
<div class="line"><span class="keyword">using </span>TCPParams = <a class="code hl_struct" href="structtec_1_1SocketClientParams.html">tec::SocketClientParams</a>;</div>
<div class="line"><span class="keyword">using </span>TCPClient = <a class="code hl_class" href="classtec_1_1SocketClientNd.html">tec::SocketClientNd&lt;TCPParams&gt;</a>;</div>
<div class="line"><span class="keyword">using </span>TCPClientWorker = <a class="code hl_class" href="classtec_1_1ActorWorker.html">tec::ActorWorker&lt;TCPParams, TCPClient&gt;</a>;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="structtec_1_1TStatus.html">tec::Status</a> tcp_client() {</div>
<div class="line">    <span class="comment">// By default, it can connect to either IPv4 or IPv6 tec::SocketServer.</span></div>
<div class="line">    TCPParams params;</div>
<div class="line">    params.<a class="code hl_variable" href="structtec_1_1SocketParams.html#ab08294f8ec6392ee60cc13564e20ecc9">compression</a> = tec::CompressionParams::kCompressionZlib;</div>
<div class="line">    <span class="comment">// To use IPv6 only:</span></div>
<div class="line">    <span class="comment">//     params.addr = tec::SocketParams::kLocalAddrIP6;</span></div>
<div class="line">    <span class="comment">//     params.family = AF_INET6;</span></div>
<div class="line">    <span class="comment">// To use IPv4 only:</span></div>
<div class="line">    <span class="comment">//     params.addr = tec::SocketParams::kLocalAddr;</span></div>
<div class="line">    <span class="comment">//     params.family = AF_INET4;</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Data to process.</span></div>
<div class="line">    GetPersonsIn persons_in;</div>
<div class="line">    GetPersonsOut persons_out;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Use Daemon interface.</span></div>
<div class="line">    <span class="keyword">auto</span> cli{TCPClientWorker::Builder&lt;TCPClientWorker, TCPClient&gt;{}(params)};</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Run it and check for the result.</span></div>
<div class="line">    <span class="keyword">auto</span> status = cli-&gt;run();</div>
<div class="line">    <span class="keywordflow">if</span>( !status ) {</div>
<div class="line">        <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;tcp_client: {}&quot;</span>, status);</div>
<div class="line">        <span class="keywordflow">return</span> status;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Request.</span></div>
<div class="line">    <a class="code hl_class" href="classtec_1_1NetData.html">tec::NetData</a> nd_in;</div>
<div class="line">    <span class="comment">// Binary serialization.</span></div>
<div class="line">    nd_in &lt;&lt; persons_in;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Reply.</span></div>
<div class="line">    <a class="code hl_class" href="classtec_1_1NetData.html">tec::NetData</a> nd_out;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Make an RPC request using the Daemon API.</span></div>
<div class="line">    <a class="code hl_struct" href="structtec_1_1NetData_1_1StreamIn.html">tec::NetData::StreamIn</a> req{&amp;nd_in};</div>
<div class="line">    <a class="code hl_struct" href="structtec_1_1NetData_1_1StreamOut.html">tec::NetData::StreamOut</a> rep{&amp;nd_out};</div>
<div class="line">    status = cli-&gt;request(&amp;req, &amp;rep);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>( !status ) {</div>
<div class="line">        <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;tcp_client: {}&quot;</span>, status);</div>
<div class="line">        <span class="keywordflow">return</span> status;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Restore reply via binary deserialization.</span></div>
<div class="line">    nd_out &gt;&gt; persons_out;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Optionally.</span></div>
<div class="line">    cli-&gt;terminate();</div>
<div class="line">    <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><span class="comment">*                             MAIN</span></div>
<div class="line"><span class="comment"> *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <span class="comment">// Run the test.</span></div>
<div class="line">    <span class="keyword">auto</span> result = tcp_client();</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;\nExited with {}&quot;</span>, result);</div>
<div class="line">    <span class="keywordflow">return</span> result.code.value_or(0);</div>
<div class="line">}</div>
<div class="ttc" id="aclasstec_1_1SocketClientNd_html"><div class="ttname"><a href="classtec_1_1SocketClientNd.html">tec::SocketClientNd</a></div><div class="ttdoc">Templated client socket actor for NetData stream handling.</div><div class="ttdef"><b>Definition</b> tec_socket_client_nd.hpp:96</div></div>
<div class="ttc" id="astructtec_1_1NetData_1_1StreamIn_html"><div class="ttname"><a href="structtec_1_1NetData_1_1StreamIn.html">tec::NetData::StreamIn</a></div><div class="ttdoc">Helper type for ADL customization of input operations.</div><div class="ttdef"><b>Definition</b> tec_net_data.hpp:478</div></div>
<div class="ttc" id="astructtec_1_1NetData_1_1StreamOut_html"><div class="ttname"><a href="structtec_1_1NetData_1_1StreamOut.html">tec::NetData::StreamOut</a></div><div class="ttdoc">Helper type for ADL customization of output operations.</div><div class="ttdef"><b>Definition</b> tec_net_data.hpp:493</div></div>
<div class="ttc" id="atec__socket__client__nd_8hpp_html"><div class="ttname"><a href="tec__socket__client__nd_8hpp.html">tec_socket_client_nd.hpp</a></div><div class="ttdoc">Definition of the SocketClientNd class template.</div></div>
</div><!-- fragment --><p>See the complete <a href="https://github.com/olddeuteronomy/tec/blob/main/samples/socket/tcp_client_nd.cpp">example</a>.</p>
<h1><a class="anchor" id="autotoc_md28"></a>
Test Results</h1>
<p>Parameters:</p>
<ul>
<li>Dell Latitude 7490, i7-8650U Ã— 8, 16 GiB</li>
<li>Ubuntu 24.04.2</li>
<li>clang++ v.18.1.3</li>
<li>Compiler options: -02 -Wall -std=c++17 -pthread</li>
<li>6 clients running in parallel.</li>
<li>Each client sends 5000 requests, 1 request per 50 ms.</li>
<li><code>tcp_server</code> / <code>tcp_server_nd</code></li>
</ul>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Mode   </th><th class="markdownTableHeadCenter">Compression   </th><th class="markdownTableHeadCenter">Thread Pool   </th><th class="markdownTableHeadCenter">Memory (when idle)   </th><th class="markdownTableHeadCenter">Startup Time    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CharStream   </td><td class="markdownTableBodyCenter">N/A   </td><td class="markdownTableBodyCenter">Off   </td><td class="markdownTableBodyCenter">258 K   </td><td class="markdownTableBodyCenter">~1 ms    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">CharStream   </td><td class="markdownTableBodyCenter">N/A   </td><td class="markdownTableBodyCenter">8 threads   </td><td class="markdownTableBodyCenter">508 K   </td><td class="markdownTableBodyCenter">~1 ms    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">NetData   </td><td class="markdownTableBodyCenter">Off   </td><td class="markdownTableBodyCenter">Off   </td><td class="markdownTableBodyCenter">262 K   </td><td class="markdownTableBodyCenter">~1 ms    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">NetData   </td><td class="markdownTableBodyCenter">Off   </td><td class="markdownTableBodyCenter">8 threads   </td><td class="markdownTableBodyCenter">578 K   </td><td class="markdownTableBodyCenter">~1 ms    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">NetData   </td><td class="markdownTableBodyCenter">Zlib   </td><td class="markdownTableBodyCenter">Off   </td><td class="markdownTableBodyCenter">300 K   </td><td class="markdownTableBodyCenter">~1 ms    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">NetData   </td><td class="markdownTableBodyCenter">Zlib   </td><td class="markdownTableBodyCenter">8 threads   </td><td class="markdownTableBodyCenter">778 K   </td><td class="markdownTableBodyCenter">~1 ms   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md29"></a>
Additional Utilities</h1>
<p>TEC bundles several small utilities and helpers:</p>
<ul>
<li><a href="https://olddeuteronomy.github.io/tec/html/tec__base64_8hpp.html">tec_base64.hpp</a> &mdash; A header-only Base64 encoder/decoder.</li>
<li><a href="https://olddeuteronomy.github.io/tec/html/tec__container_8hpp.html">tec_container.hpp</a> &ndash; Generic container and map traits.</li>
<li><a href="https://olddeuteronomy.github.io/tec/html/tec__dump_8hpp.html">tec_dump.hpp</a> &mdash; Debugging/inspecting helpers.</li>
<li><a href="https://olddeuteronomy.github.io/tec/html/tec__guid_8hpp.html">tec_guid.hpp</a> &mdash; GUID generation utilities.</li>
<li><a href="https://olddeuteronomy.github.io/tec/html/tec__json_8hpp.html">tec_json.hpp</a> &mdash; Simple JSON serialization.</li>
<li><a href="https://olddeuteronomy.github.io/tec/html/tec__memfile_8hpp.html">tec_memfile.hpp</a> &mdash; A byte buffer class with stream-like read/write semantics.</li>
<li><a href="https://olddeuteronomy.github.io/tec/html/tec__message_8hpp.html">tec_message.hpp</a> &mdash; Defines a flexible message type and helper functions.</li>
<li><a href="https://olddeuteronomy.github.io/tec/html/tec__print_8hpp.html">tec_print.hpp</a> &mdash; Provides variadic print and format utilities.</li>
<li><a href="https://olddeuteronomy.github.io/tec/html/tec__queue_8hpp.html">tec_queue.hpp</a> &mdash; Thread-safe queue implementation.</li>
<li><a href="https://olddeuteronomy.github.io/tec/html/tec__serialize_8hpp.html">tec_serialize.hpp</a> &mdash; he base interface for serializable objects.</li>
<li><a href="https://olddeuteronomy.github.io/tec/html/tec__signal_8hpp.html">tec_signal.hpp</a> &mdash; Defines a thread-safe signal implementation using mutex and condition variable.</li>
<li><a href="https://olddeuteronomy.github.io/tec/html/tec__status_8hpp.html">tec_status.hpp</a> &mdash; Defines error handling types and utilities.</li>
<li><a href="https://olddeuteronomy.github.io/tec/html/tec__thread__pool_8hpp.html">tec_thread_pool.hpp</a> &mdash; Simple, non-stealing thread pool implementation using a single shared task queue.</li>
<li><a href="https://olddeuteronomy.github.io/tec/html/tec__timestamp_8hpp.html">tec_timestamp.hpp</a> &mdash; A point in time since UNIX epoch.</li>
<li><a href="https://olddeuteronomy.github.io/tec/html/tec__trace_8hpp.html">tec_trace.hpp</a> &mdash; Provides a thread-safe tracing utility for debugging.</li>
<li><a href="https://olddeuteronomy.github.io/tec/html/tec__utils_8hpp.html">tec_utils.hpp</a> &mdash; Provides time-related utilities and system information functions.</li>
<li><a href="https://olddeuteronomy.github.io/tec/html/tec__nd__compress_8hpp.html">net/tec_nd_compress.hpp</a> &mdash; Compression wrapper for NetData objects with pluggable backends.</li>
</ul>
<h1><a class="anchor" id="autotoc_md30"></a>
gRPC</h1>
<p>Historically, the TEC library was originally created to make working with gRPC servers and clients cleaner, more modular, and much less verbose.</p>
<h2><a class="anchor" id="autotoc_md31"></a>
Motivation</h2>
<p><a href="https://grpc.io/">gRPC</a> is a powerful and performant RPC framework, but its generated code and service implementation tend to tightly couple business logic with gRPC-specific headers, stubs, completion queues, and low-level details. This leads to:</p>
<ul>
<li>Heavy include-graph dependencies across the project</li>
<li>Slower compilation times</li>
<li>Difficult testing and mocking of services</li>
<li>Reduced reusability of business logic outside gRPC contexts</li>
</ul>
<p>TEC was created to solve exactly these problems by introducing a clean <b>abstraction layer</b>:</p>
<ul>
<li>Decouples <b>gRPC implementation details</b> from your application code</li>
<li>Hides gRPC headers from most compilation units</li>
<li>Provides a universal, minimal interface for sending/receiving messages and requests</li>
<li>Enables fast compilation and better separation of concerns</li>
<li>Remains platform-independent and easily extensible</li>
</ul>
<p>The result is a small set of <b>template-based</b> abstractions that can be used both with gRPC and in many other multithreaded scenarios (TCP servers/clients, message queues, background workers, etc.).</p>
<h2><a class="anchor" id="autotoc_md32"></a>
GrpcServerParams</h2>
<p>Configuration parameters for gRPC server instances.</p>
<p>See the complete documentation of <a href="https://olddeuteronomy.github.io/tec/html/structtec_1_1GrpcServerParams.html">GrpcServerParams</a>.</p>
<h2><a class="anchor" id="autotoc_md33"></a>
GrpcClientParams</h2>
<p>Configuration parameters for gRPC client instances.</p>
<p>Defines default timeouts and configuration options for gRPC client operations.</p>
<p>See the complete documentation of <a href="https://olddeuteronomy.github.io/tec/html/structtec_1_1GrpcClientParams.html">GrpcClientParams</a>.</p>
<h2><a class="anchor" id="autotoc_md34"></a>
GrpcServer</h2>
<p>Base class for actor-style gRPC servers. Declares a generic, actor-based gRPC server template that can be specialized for different gRPC services via template parameters.</p>
<p><img src="img/GrpcServer.png" alt="" class="inline"/></p>
<p>Provides common infrastructure for:</p>
<ul>
<li>configuring server builder (message size limits, compression)</li>
<li>enabling optional features (health checking, reflection)</li>
<li>starting a listening server with timeout-protected startup</li>
<li>graceful shutdown</li>
</ul>
<p>Concrete servers should inherit from this class and implement <code>process_request()</code> if synchronous request handling is needed, or override <code>start()</code> / use async service registration patterns.</p>
<p>See the complete documentation of <a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1GrpcServer.html">GrpcServer</a>.</p>
<p>See also:</p>
<ul>
<li><a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1Actor.html">Actor</a></li>
<li><a href="https://olddeuteronomy.github.io/tec/html/structtec_1_1GrpcServerParams.html">GrpcServerParams</a></li>
</ul>
<h3><a class="anchor" id="autotoc_md35"></a>
Example: GrpcServer Declarations</h3>
<p>Key points:</p>
<ul>
<li>gRPC headers are not in use.</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">// samples/grpc/server.hpp</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__daemon_8hpp.html">tec/tec_daemon.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__grpc_8hpp.html">tec/grpc/tec_grpc.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate gRPC server parameters.</span></div>
<div class="line"><span class="keyword">struct </span>ServerParams: <span class="keyword">public</span> <a class="code hl_struct" href="structtec_1_1GrpcServerParams.html">tec::GrpcServerParams</a> {</div>
<div class="line">    <span class="comment">// You can add custom parameters here.</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// GrpcServer builder -- implemented in server.cpp</span></div>
<div class="line">std::unique_ptr&lt;tec::Daemon&gt; build_server(<span class="keyword">const</span> ServerParams&amp; _params);</div>
<div class="ttc" id="astructtec_1_1GrpcServerParams_html"><div class="ttname"><a href="structtec_1_1GrpcServerParams.html">tec::GrpcServerParams</a></div><div class="ttdoc">Configuration parameters for gRPC server instances.</div><div class="ttdef"><b>Definition</b> tec_grpc.hpp:71</div></div>
<div class="ttc" id="atec__grpc_8hpp_html"><div class="ttname"><a href="tec__grpc_8hpp.html">tec_grpc.hpp</a></div><div class="ttdoc">Generic gRPC parameters.</div></div>
</div><!-- fragment --><p>See the complete <a href="https://github.com/olddeuteronomy/tec/blob/main/samples/grpc/server.hpp">example</a>.</p>
<h3><a class="anchor" id="autotoc_md36"></a>
Example: GrpcServer Implementation</h3>
<div class="fragment"><div class="line"><span class="comment">// samples/grpc/server.cpp</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// stdlib++</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;csignal&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// gRPC headers.</span></div>
<div class="line"><span class="preprocessor">#include &lt;grpc/compression.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;grpcpp/grpcpp.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;grpcpp/ext/proto_server_reflection_plugin.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;grpcpp/health_check_service_interface.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Protobuf generated.</span></div>
<div class="line"><span class="preprocessor">#include &quot;helloworld.grpc.pb.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;helloworld.pb.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// TEC</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__print_8hpp.html">tec/tec_print.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__daemon_8hpp.html">tec/tec_daemon.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__actor__worker_8hpp.html">tec/tec_actor_worker.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__grpc_8hpp.html">tec/grpc/tec_grpc.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__grpc__server_8hpp.html">tec/grpc/tec_grpc_server.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;server.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using </span>grpc::Status;</div>
<div class="line"><span class="keyword">using </span>grpc::ServerContext;</div>
<div class="line"><span class="keyword">using </span>helloworld::Greeter;</div>
<div class="line"><span class="keyword">using </span>helloworld::HelloReply;</div>
<div class="line"><span class="keyword">using </span>helloworld::HelloRequest;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><span class="comment">*                        Implement gRPC Service</span></div>
<div class="line"><span class="comment"> *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> count{0};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Implement gRPC service -- logic and data behind the server&#39;s behavior.</span></div>
<div class="line"><span class="keyword">class </span>TestService final : <span class="keyword">public</span> Greeter::Service {</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Prefixing `request` with &quot;Hello&quot;.</span></div>
<div class="line">    Status SayHello(ServerContext *context, <span class="keyword">const</span> HelloRequest *request, HelloReply *reply)<span class="keyword"> override </span>{</div>
<div class="line">        count += 1;</div>
<div class="line">        tec::println(<span class="stringliteral">&quot;\nREQUEST #{}: &lt;- \&quot;{}\&quot;&quot;</span>, count, request-&gt;name());</div>
<div class="line">        <span class="comment">// Set reply.</span></div>
<div class="line">        reply-&gt;set_message(<span class="stringliteral">&quot;Hello &quot;</span> + request-&gt;name() + <span class="stringliteral">&quot;!&quot;</span>);</div>
<div class="line">        <span class="comment">// Set metadata.</span></div>
<div class="line">        tec::add_server_medadata(context, <span class="stringliteral">&quot;req_num&quot;</span>, std::to_string(count));</div>
<div class="line">        tec::println(<span class="stringliteral">&quot;REPLY #{}:   -&gt; \&quot;{}\&quot;&quot;</span>, count, reply-&gt;message());</div>
<div class="line">        <span class="keywordflow">return</span> Status::OK;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">}; <span class="comment">// ::TestService</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><span class="comment">*                              Server</span></div>
<div class="line"><span class="comment"> *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate Server traits.</span></div>
<div class="line"><span class="keyword">using </span>ServerTraits = <a class="code hl_struct" href="structtec_1_1grpc__server__traits.html">tec::grpc_server_traits</a>&lt;</div>
<div class="line">    TestService</div>
<div class="line">    , grpc::Server</div>
<div class="line">    , grpc::ServerBuilder</div>
<div class="line">    , grpc::ServerCredentials</div>
<div class="line">    , grpc_compression_algorithm</div>
<div class="line">    , grpc_compression_level</div>
<div class="line">    &gt;;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate gRPC Server.</span></div>
<div class="line"><span class="keyword">class </span>Server: <span class="keyword">public</span> <a class="code hl_class" href="classtec_1_1GrpcServer.html">tec::GrpcServer</a>&lt;ServerParams, ServerTraits&gt; {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    Server(<span class="keyword">const</span> ServerParams&amp; params)</div>
<div class="line">        : tec::GrpcServer&lt;ServerParams, ServerTraits&gt;{params, grpc::InsecureServerCredentials()}</div>
<div class="line">    {}</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate gRPC Server ActorWorker.</span></div>
<div class="line"><span class="keyword">using </span>ServerWorker = <a class="code hl_class" href="classtec_1_1ActorWorker.html">tec::ActorWorker&lt;ServerParams, Server&gt;</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><span class="comment">*                           Server builder</span></div>
<div class="line"><span class="comment"> *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/</span></div>
<div class="line"> </div>
<div class="line">std::unique_ptr&lt;tec::Daemon&gt; build_server(<span class="keyword">const</span> ServerParams&amp; _params) {</div>
<div class="line">    ServerParams params{_params};</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Set additional gRPC server parameters.</span></div>
<div class="line">    params.health_check_builder = {&amp;grpc::EnableDefaultHealthCheckService};</div>
<div class="line">    params.reflection_builder = {&amp;grpc::reflection::InitProtoReflectionServerBuilderPlugin};</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ServerWorker::Builder&lt;ServerWorker, Server&gt;{}(params);</div>
<div class="line">}</div>
<div class="ttc" id="aclasstec_1_1GrpcServer_html"><div class="ttname"><a href="classtec_1_1GrpcServer.html">tec::GrpcServer</a></div><div class="ttdoc">Base class for actor-style gRPC servers.</div><div class="ttdef"><b>Definition</b> tec_grpc_server.hpp:106</div></div>
<div class="ttc" id="astructtec_1_1grpc__server__traits_html"><div class="ttname"><a href="structtec_1_1grpc__server__traits.html">tec::grpc_server_traits</a></div><div class="ttdoc">Type traits / type aliases collection for configuring a gRPC server.</div><div class="ttdef"><b>Definition</b> tec_grpc_server.hpp:73</div></div>
<div class="ttc" id="atec__grpc__server_8hpp_html"><div class="ttname"><a href="tec__grpc__server_8hpp.html">tec_grpc_server.hpp</a></div><div class="ttdoc">gRPC server template.</div></div>
</div><!-- fragment --><p>See the complete <a href="https://github.com/olddeuteronomy/tec/blob/main/samples/grpc/server.cpp">example</a>.</p>
<h3><a class="anchor" id="autotoc_md37"></a>
Example: Run GrpcServer</h3>
<p>Key points:</p>
<ul>
<li>gRPC implementation details are decoupled from the application code.</li>
<li>gRPC headers are not in use.</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">// samples/grpc/test_server.hpp</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;csignal&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__print_8hpp.html">tec/tec_print.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__daemon_8hpp.html">tec/tec_daemon.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;server.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="classtec_1_1Signal.html">tec::Signal</a> sig_quit;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><span class="comment">*                          Run the server</span></div>
<div class="line"><span class="comment"> *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="structtec_1_1TStatus.html">tec::Status</a> run() {</div>
<div class="line">    <span class="comment">// The gRPC daemon.</span></div>
<div class="line">    ServerParams params;</div>
<div class="line">    <span class="keyword">auto</span> daemon = build_server(params);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Start the daemon.</span></div>
<div class="line">    tec::println(<span class="stringliteral">&quot;Starting ...&quot;</span>);</div>
<div class="line">    <span class="keyword">auto</span> status = daemon-&gt;run();</div>
<div class="line">    <span class="keywordflow">if</span>( !status ) {</div>
<div class="line">        tec::println(<span class="stringliteral">&quot;Exited abnormally with {}.&quot;</span>, status);</div>
<div class="line">        <span class="keywordflow">return</span> status;</div>
<div class="line">    }</div>
<div class="line">    tec::println(<span class="stringliteral">&quot;Server listening on \&quot;{}\&quot;&quot;</span>, params.addr_uri);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Wait for &lt;Ctrl-C&gt; pressed to terminate the server.</span></div>
<div class="line">    tec::println(<span class="stringliteral">&quot;\nPRESS &lt;Ctrl-C&gt; TO QUIT THE SERVER&quot;</span>);</div>
<div class="line">    sig_quit.<a class="code hl_function" href="classtec_1_1Signal.html#a860ddfd3248f3024a105527ec80b4b17">wait</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Terminate the server.</span></div>
<div class="line">    status = daemon-&gt;terminate();</div>
<div class="line">    <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><span class="comment">*                             MAIN</span></div>
<div class="line"><span class="comment"> *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <span class="comment">// Install Ctrl-C handler.</span></div>
<div class="line">    std::signal(SIGINT, [](<span class="keywordtype">int</span>){ sig_quit.<a class="code hl_function" href="classtec_1_1Signal.html#a117cf58d6581b8695abf2902afa753aa">set</a>(); });</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> status = run();</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;\nExited with {}&quot;</span>, status);</div>
<div class="line">    <span class="keywordflow">return</span> status.code.value_or(0);</div>
<div class="line">}</div>
</div><!-- fragment --><p>See the complete <a href="https://github.com/olddeuteronomy/tec/blob/main/samples/grpc/test_server.cpp">example</a>.</p>
<h2><a class="anchor" id="autotoc_md38"></a>
GrpcClient</h2>
<p>Base class for actor-style asynchronous gRPC clients.</p>
<p><img src="img/GrpcClient.png" alt="" class="inline"/></p>
<p>Provides common infrastructure for creating and managing a gRPC channel, configuring message size limits and compression, connecting with timeout, and creating a service stub.</p>
<p>Concrete clients should inherit from this class and implement <code>process_request()</code> to perform actual RPC calls.</p>
<p>See the complete documentation of <a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1GrpcClient.html">GrpcClient</a>.</p>
<p>See also:</p>
<ul>
<li><a href="https://olddeuteronomy.github.io/tec/html/classtec_1_1Actor.html">Actor</a></li>
<li><a href="https://olddeuteronomy.github.io/tec/html/structtec_1_1GrpcClientParams.html">GrpcClientParams</a>.</li>
</ul>
<h3><a class="anchor" id="autotoc_md39"></a>
Example: GrpcClient Declarations</h3>
<p>Key points:</p>
<ul>
<li>gRPC headers are not in use.</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">// samples/grpc/client.hpp</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__daemon_8hpp.html">tec/tec_daemon.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__grpc_8hpp.html">tec/grpc/tec_grpc.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate gRPC client parameters.</span></div>
<div class="line"><span class="keyword">struct </span>ClientParams: <span class="keyword">public</span> <a class="code hl_struct" href="structtec_1_1GrpcClientParams.html">tec::GrpcClientParams</a> {</div>
<div class="line">    <span class="comment">// You can add custom parameters here.</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Test request/reply.</span></div>
<div class="line"><span class="keyword">struct </span>TestHelloRequest {</div>
<div class="line">    std::string name;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>TestHelloReply {</div>
<div class="line">    std::string message;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Client builder -- implemented in client.cpp</span></div>
<div class="line">std::unique_ptr&lt;tec::Daemon&gt; build_client(<span class="keyword">const</span> ClientParams&amp;);</div>
<div class="ttc" id="astructtec_1_1GrpcClientParams_html"><div class="ttname"><a href="structtec_1_1GrpcClientParams.html">tec::GrpcClientParams</a></div><div class="ttdoc">Configuration parameters for gRPC client instances.</div><div class="ttdef"><b>Definition</b> tec_grpc.hpp:125</div></div>
</div><!-- fragment --><p>See the complete <a href="https://github.com/olddeuteronomy/tec/blob/main/samples/grpc/client.hpp">example</a>.</p>
<h3><a class="anchor" id="autotoc_md40"></a>
Example: GrpcClient Implementation</h3>
<div class="fragment"><div class="line"><span class="comment">// samples/grpc/client.cpp</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// stdlib++</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstdio&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;csignal&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// gRPC</span></div>
<div class="line"><span class="preprocessor">#include &lt;grpc/compression.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;grpcpp/grpcpp.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Protobuf generated</span></div>
<div class="line"><span class="preprocessor">#include &quot;helloworld.grpc.pb.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;helloworld.pb.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// TEC</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__daemon_8hpp.html">tec/tec_daemon.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__print_8hpp.html">tec/tec_print.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__status_8hpp.html">tec/tec_status.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__message_8hpp.html">tec/tec_message.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__actor__worker_8hpp.html">tec/tec_actor_worker.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__grpc__client_8hpp.html">tec/grpc/tec_grpc_client.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;client.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate Client traits.</span></div>
<div class="line"><span class="keyword">using </span>ClientTraits = <a class="code hl_struct" href="structtec_1_1grpc__client__traits.html">tec::grpc_client_traits</a>&lt;</div>
<div class="line">    helloworld::Greeter</div>
<div class="line">    , grpc::Channel</div>
<div class="line">    , grpc::ChannelCredentials</div>
<div class="line">    , grpc::ChannelArguments</div>
<div class="line">    , grpc_compression_algorithm</div>
<div class="line">    &gt;;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate a Client.</span></div>
<div class="line"><span class="keyword">using </span>BaseClient = <a class="code hl_class" href="classtec_1_1GrpcClient.html">tec::GrpcClient&lt;ClientParams, ClientTraits&gt;</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><span class="comment">*                        Client implementation</span></div>
<div class="line"><span class="comment"> *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>Client final: <span class="keyword">public</span> BaseClient {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    Client(<span class="keyword">const</span> ClientParams&amp; params,</div>
<div class="line">           <span class="keyword">const</span> std::shared_ptr&lt;grpc::ChannelCredentials&gt;&amp; credentials</div>
<div class="line">        )</div>
<div class="line">        : BaseClient(params, {&amp;grpc::CreateCustomChannel}, credentials)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="structtec_1_1TStatus.html">tec::Status</a> process_request(<a class="code hl_typedef" href="tec__message_8hpp.html#ac905c839f081b87377f26c0f2a0824d0">tec::Request</a> _request, <a class="code hl_typedef" href="tec__message_8hpp.html#a5de784b32e4bb620c4495a0413e118e7">tec::Reply</a> _reply)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="comment">// Check type match.</span></div>
<div class="line">        <span class="comment">// NOTE: *Request* is const!</span></div>
<div class="line">        <span class="comment">// NOTE: Both _request and _reply contain **pointers** to actual data.</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span>( _request.type() == <span class="keyword">typeid</span>(<span class="keyword">const</span> TestHelloRequest*) &amp;&amp;</div>
<div class="line">            _reply.type() == <span class="keyword">typeid</span>(TestHelloReply*) ) {</div>
<div class="line">            <span class="comment">// Get pointers to actual data.</span></div>
<div class="line">            <span class="keyword">auto</span> req = std::any_cast&lt;const TestHelloRequest*&gt;(_request);</div>
<div class="line">            <span class="keyword">auto</span> rep = std::any_cast&lt;TestHelloReply*&gt;(_reply);</div>
<div class="line">            <span class="keywordflow">return</span> make_grpc_request(req, rep);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> {<a class="code hl_enumvalue" href="structtec_1_1Error.html#aa8e779eed4e02e4f62add303fba422b1ab4080bdf74febf04d578ff105cce9d3f">tec::Error::Kind::Unsupported</a>};</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <a class="code hl_class" href="structtec_1_1TStatus.html">tec::Status</a> make_grpc_request(<span class="keyword">const</span> TestHelloRequest* _request, TestHelloReply* _reply) {</div>
<div class="line">        <span class="comment">// Data we are sending to the server.</span></div>
<div class="line">        helloworld::HelloRequest request;</div>
<div class="line">        request.set_name(_request-&gt;name);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Container for the data we expect from the server.</span></div>
<div class="line">        helloworld::HelloReply reply;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Context for the client. It could be used to convey extra information to</span></div>
<div class="line">        <span class="comment">// the server and/or tweak certain gRPC behavior.</span></div>
<div class="line">        grpc::ClientContext context;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// The actual RPC.</span></div>
<div class="line">        <span class="keyword">auto</span> status = stub_-&gt;SayHello(&amp;context, request, &amp;reply);</div>
<div class="line">        <span class="keywordflow">if</span>( !status.ok() ) {</div>
<div class="line">            <span class="keywordflow">return</span> {status.error_code(), status.error_message(), <a class="code hl_enumvalue" href="structtec_1_1Error.html#aa8e779eed4e02e4f62add303fba422b1ac80b35b85dc401b8dd40996a0a81a4b6">tec::Error::Kind::RpcErr</a>};</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Get server metadata.</span></div>
<div class="line">        std::string postfix = <a class="code hl_function" href="tec__print_8hpp.html#a9a8ea0398a13ec330d72d207d0bb46b2">tec::format</a>(<span class="stringliteral">&quot; #{}&quot;</span>, tec::get_server_metadata(context, <span class="stringliteral">&quot;req_num&quot;</span>));</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Fill the reply.</span></div>
<div class="line">        _reply-&gt;message = reply.message() + postfix;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> {};</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">}; <span class="comment">// class Client</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><span class="comment">*                         Client Builder</span></div>
<div class="line"><span class="comment"> *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using </span>ClientWorker = <a class="code hl_class" href="classtec_1_1ActorWorker.html">tec::ActorWorker&lt;ClientParams, Client&gt;</a>;</div>
<div class="line"> </div>
<div class="line">std::unique_ptr&lt;tec::Daemon&gt; build_client(<span class="keyword">const</span> ClientParams&amp; params) {</div>
<div class="line">    <span class="keyword">auto</span> actor{std::make_unique&lt;Client&gt;(params, grpc::InsecureChannelCredentials())};</div>
<div class="line">    <span class="keywordflow">return</span> std::make_unique&lt;ClientWorker&gt;(params, std::move(actor));</div>
<div class="line">}</div>
<div class="ttc" id="aclasstec_1_1GrpcClient_html"><div class="ttname"><a href="classtec_1_1GrpcClient.html">tec::GrpcClient</a></div><div class="ttdoc">Base class for actor-style asynchronous gRPC clients.</div><div class="ttdef"><b>Definition</b> tec_grpc_client.hpp:100</div></div>
<div class="ttc" id="astructtec_1_1Error_html_aa8e779eed4e02e4f62add303fba422b1ac80b35b85dc401b8dd40996a0a81a4b6"><div class="ttname"><a href="structtec_1_1Error.html#aa8e779eed4e02e4f62add303fba422b1ac80b35b85dc401b8dd40996a0a81a4b6">tec::Error::Kind::RpcErr</a></div><div class="ttdeci">@ RpcErr</div><div class="ttdoc">Remote procedure call error.</div></div>
<div class="ttc" id="astructtec_1_1grpc__client__traits_html"><div class="ttname"><a href="structtec_1_1grpc__client__traits.html">tec::grpc_client_traits</a></div><div class="ttdoc">Type traits / type aliases collection for configuring a gRPC client.</div><div class="ttdef"><b>Definition</b> tec_grpc_client.hpp:71</div></div>
<div class="ttc" id="atec__grpc__client_8hpp_html"><div class="ttname"><a href="tec__grpc__client_8hpp.html">tec_grpc_client.hpp</a></div><div class="ttdoc">gRPC client template.</div></div>
<div class="ttc" id="atec__print_8hpp_html_a9a8ea0398a13ec330d72d207d0bb46b2"><div class="ttname"><a href="tec__print_8hpp.html#a9a8ea0398a13ec330d72d207d0bb46b2">tec::format</a></div><div class="ttdeci">std::string format(const T &amp;arg)</div><div class="ttdoc">Formats a single argument into a string.</div><div class="ttdef"><b>Definition</b> tec_print.hpp:171</div></div>
</div><!-- fragment --><p>See the complete <a href="https://github.com/olddeuteronomy/tec/blob/main/samples/grpc/client.cpp">example</a>.</p>
<h3><a class="anchor" id="autotoc_md41"></a>
Example: Run GrpcClient</h3>
<p>Key points:</p>
<ul>
<li>gRPC implementation details are decoupled from the application code.</li>
<li>gRPC headers are not in use.</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">// samples/grpc/test_client.cpp</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;atomic&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;csignal&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tec__print_8hpp.html">tec/tec_print.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;client.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div>
<div class="line"><span class="comment">*                         MAIN</span></div>
<div class="line"><span class="comment"> *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/</span></div>
<div class="line"> </div>
<div class="line">std::atomic_bool quit{<span class="keyword">false</span>};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <span class="comment">// Install Ctrl-C handler.</span></div>
<div class="line">    std::signal(SIGINT, [](<span class="keywordtype">int</span>){quit.store(<span class="keyword">true</span>);});</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create a client.</span></div>
<div class="line">    ClientParams params;</div>
<div class="line">    <span class="keyword">auto</span> client{build_client(params)};</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Connect to the server.</span></div>
<div class="line">    <span class="keyword">auto</span> result = client-&gt;run();</div>
<div class="line">    <span class="keywordflow">if</span>( !result ) {</div>
<div class="line">        <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;Abnormally exited with {}.&quot;</span>, result);</div>
<div class="line">        <span class="keywordflow">return</span> result.code.value_or(<a class="code hl_struct" href="structtec_1_1Error_1_1Code.html">tec::Error::Code&lt;&gt;::Unspecified</a>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Make requests to the server.</span></div>
<div class="line">    <span class="keywordflow">while</span>( !quit ) {</div>
<div class="line">        <span class="comment">// Make a call and print a result.</span></div>
<div class="line">        TestHelloRequest req{<span class="stringliteral">&quot;world&quot;</span>};</div>
<div class="line">        TestHelloReply rep;</div>
<div class="line">        <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;{} -&gt;&quot;</span>, req.name);</div>
<div class="line">        <span class="keyword">auto</span> status = client-&gt;request&lt;&gt;(&amp;req, &amp;rep);</div>
<div class="line">        <span class="keywordflow">if</span>( !status ) {</div>
<div class="line">            <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;Error: {}&quot;</span>, status);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">            <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;&lt;- {}&quot;</span>, rep.message);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;\nPRESS &lt;Return&gt; TO REPEAT THE REQUEST...&quot;</span>);</div>
<div class="line">        <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;PRESS &lt;Ctrl-C&gt; THEN &lt;Return&gt; TO QUIT&quot;</span>);</div>
<div class="line">        getchar();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Clean up.</span></div>
<div class="line">    result = client-&gt;terminate();</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="tec__print_8hpp.html#ac49b732037c57831802a8060d1d483da">tec::println</a>(<span class="stringliteral">&quot;Exited with {}.&quot;</span>, result);</div>
<div class="line">    <span class="keywordflow">return</span> result.code.value_or(0);</div>
<div class="line">}</div>
<div class="ttc" id="astructtec_1_1Error_1_1Code_html"><div class="ttname"><a href="structtec_1_1Error_1_1Code.html">tec::Error::Code</a></div><div class="ttdoc">Defines error codes with a default unspecified value.</div><div class="ttdef"><b>Definition</b> tec_status.hpp:72</div></div>
</div><!-- fragment --><p>See the complete <a href="https://github.com/olddeuteronomy/tec/blob/main/samples/grpc/test_client.cpp">example</a>.</p>
<h1><a class="anchor" id="autotoc_md42"></a>
Building Samples</h1>
<p>The <code>samples/</code> directory contains a set of TEC usage examples, with each subdirectory including a corresponding Makefile.</p>
<p>To force rebuild with <code>g++</code> (default, no optimization (<code>-O0</code>), w/debug info (<code>-g</code>)): </p><div class="fragment"><div class="line">make -k -B -j4</div>
</div><!-- fragment --><p>To force rebuild with <code>clang++</code>: </p><div class="fragment"><div class="line">make -k -B -j4 CLANG=1</div>
</div><!-- fragment --><p>To build with the Zlib compression library: </p><div class="fragment"><div class="line">make -k -B -j4 ZLIB=1</div>
</div><!-- fragment --><p>To build a release (<code>g++</code>, <code>-O2</code>, no debug info) </p><div class="fragment"><div class="line">make -k -B -j4 REL=1</div>
</div><!-- fragment --><p>These <code>make</code> flags can be combined: </p><div class="fragment"><div class="line"># To build a release with clang++ (-O2, no debug info, linked with Zlib)</div>
<div class="line">make -k -B -j4 CLANG=1 REL=1 ZLIB=1</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md43"></a>
LICENSE</h1>
<pre>
Copyright (C) 2020-2026 The Emacs Cat.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</pre><h1><a class="anchor" id="autotoc_md44"></a>
NOTICE</h1>
<h2><a class="anchor" id="autotoc_md45"></a>
zlib</h2>
<p>The following applies if zlib is optionally enabled in the TEC library's build configuration:</p>
<pre>
Copyright (C) 1995-2024 Jean-loup Gailly and Mark Adler.

Licensed under the zlib License. See the full terms at
<a href="https://zlib.net/zlib_license.html">https://zlib.net/zlib_license.html</a>.
</pre><p>#</p>
<h1><a class="anchor" id="autotoc_md46"></a>
gRPC</h1>
<p>The following applies if gRPC is optionally used in the TEC library:</p>
<pre>
Copyright (C) 2014-2023 The gRPC Authors.

Licensed under the Apache License, Version 2.0.
You may obtain a copy at

  <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>.

See the full license terms at

  <a href="https://github.com/grpc/grpc/blob/master/LICENSE">https://github.com/grpc/grpc/blob/master/LICENSE</a>.

Certain components (e.g., Objective-C podspecs) may use BSD 3-Clause
License (Copyright 2016 Google Inc.), and roots.pem uses Mozilla
Public License 2.0. Consult the full LICENSE for details on
redistribution.
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
